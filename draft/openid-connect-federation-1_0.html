<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="scripts" content="Common,Latin">
<title>OpenID Connect Federation 1.0 -
      draft 08
    </title>
<meta name="author" content="Roland Hedberg">
<meta name="author" content="Michael B. Jones">
<meta name="author" content="Andreas Åkre Solberg">
<meta name="author" content="Samuel Gulliksson">
<meta name="author" content="John Bradley">
<meta name="description" content="
       
 The OpenID Connect standard specifies how a Relying Party (RP)
        can discover metadata about an OpenID Provider (OP), and then
        register to obtain RP credentials. The discovery and
        registration process does not involve any mechanisms of
        dynamically establishing trust in the exchanged information, but
        instead rely on out-of-band trust establishment.
       
       
 In an identity federation context, this is not sufficient. The
        participants of the federation must be able to trust information
        provided about other participants in the federation. OpenID
        Connect Federations specifies how trust can be dynamically
        obtained by resolving trust from a common trusted third party.
       
       
 While this specification is primarily targeting OpenID Connect,
        it is designed to allow for re-use by other
        protocols and in other use cases.
       
    ">
<meta name="generator" content="xml2rfc 2.22.3">
<meta name="keyword" content="OpenID">
<meta name="keyword" content="Connect">
<meta name="keyword" content="Federation">
<link rel="alternate" type="application/rfc+xml" href="openid-connect-federation-1_0.xml">
<link rel="license" href="#copyright">
<style type="text/css">/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
  z-index: 2;
}
a[href] {
  color: #3E8EDE;
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #777;
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #b76427;
  background-color: rgba(249, 232, 105, 0.3);
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: rgba(249, 232, 105, 0.3);
  border-radius: 3px;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.art-text pre {
  line-height: 1.12;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Avoid wrapping of URLs in references */
.references a {
  white-space: nowrap;
}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
</style>
<link rel="stylesheet" href="rfc-local.css" type="text/css">
</head>
<body>
<table class="ears">
<thead><tr>
<td class="left"></td>
<td class="center">OpenID Connect Federation</td>
<td class="right">June 2019</td>
</tr></thead>
<tfoot><tr>
<td class="left">Hedberg, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">OpenID Connect Working Group</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2019-06-20" class="published">20 June 2019</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Hedberg, <span class="editor">Ed.</span>
</div>
<div class="org">independent</div>
</div>
<div class="author">
      <div class="author-name">M.B. Jones</div>
<div class="org">Microsoft</div>
</div>
<div class="author">
      <div class="author-name">A.Å. Solberg</div>
<div class="org">Uninett</div>
</div>
<div class="author">
      <div class="author-name">S. Gulliksson</div>
<div class="org">Schibsted</div>
</div>
<div class="author">
      <div class="author-name">J. Bradley</div>
<div class="org">Yubico</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">OpenID Connect Federation 1.0 -
      draft 08
    </h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
 The OpenID Connect standard specifies how a Relying Party (RP)
        can discover metadata about an OpenID Provider (OP), and then
        register to obtain RP credentials. The discovery and
        registration process does not involve any mechanisms of
        dynamically establishing trust in the exchanged information, but
        instead rely on out-of-band trust establishment.
      <a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">
 In an identity federation context, this is not sufficient. The
        participants of the federation must be able to trust information
        provided about other participants in the federation. OpenID
        Connect Federations specifies how trust can be dynamically
        obtained by resolving trust from a common trusted third party.
      <a href="#section-abstract-2" class="pilcrow">¶</a></p>
<p id="section-abstract-3">
 While this specification is primarily targeting OpenID Connect,
        it is designed to allow for re-use by other
        protocols and in other use cases.
      <a href="#section-abstract-3" class="pilcrow">¶</a></p>
</section>
<div id="toc">
<section id="section-boilerplate.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents-2">
<a href="#name-table-of-contents-2" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.1">
            <p id="section-boilerplate.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction-2" class="xref">Introduction</a><a href="#section-boilerplate.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.1.2.1">
                <p id="section-boilerplate.1-1.1.2.1.1"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-requirements-language-2" class="xref">Requirements Language</a><a href="#section-boilerplate.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.1.2.2">
                <p id="section-boilerplate.1-1.1.2.2.1"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-terminology-2" class="xref">Terminology</a><a href="#section-boilerplate.1-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.2">
            <p id="section-boilerplate.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-components-2" class="xref">Components</a><a href="#section-boilerplate.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.2.2.1">
                <p id="section-boilerplate.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-entity-statement-2" class="xref">Entity Statement</a><a href="#section-boilerplate.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.2.2.2">
                <p id="section-boilerplate.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-trust-chain-2" class="xref">Trust Chain</a><a href="#section-boilerplate.1-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.3">
            <p id="section-boilerplate.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-metadata-2" class="xref">Metadata</a><a href="#section-boilerplate.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.3.2.1">
                <p id="section-boilerplate.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-rp-metadata-2" class="xref">RP Metadata</a><a href="#section-boilerplate.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.3.2.2">
                <p id="section-boilerplate.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-op-metadata-2" class="xref">OP Metadata</a><a href="#section-boilerplate.1-1.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.3.2.3">
                <p id="section-boilerplate.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-oauth-authorization-server-2" class="xref">OAuth Authorization Server</a><a href="#section-boilerplate.1-1.3.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.3.2.4">
                <p id="section-boilerplate.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-oauth-client-2" class="xref">OAuth Client</a><a href="#section-boilerplate.1-1.3.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.3.2.5">
                <p id="section-boilerplate.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-oauth-protected-resource-2" class="xref">OAuth Protected Resource</a><a href="#section-boilerplate.1-1.3.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.3.2.6">
                <p id="section-boilerplate.1-1.3.2.6.1"><a href="#section-3.6" class="xref">3.6</a>.  <a href="#name-federation-entity-2" class="xref">Federation Entity</a><a href="#section-boilerplate.1-1.3.2.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.4">
            <p id="section-boilerplate.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-applying-policy-to-metadata-2" class="xref">Applying Policy to Metadata</a><a href="#section-boilerplate.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.1">
                <p id="section-boilerplate.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-policy-language-2" class="xref">Policy Language</a><a href="#section-boilerplate.1-1.4.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.1.2.1">
                    <p id="section-boilerplate.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-subset_of-2" class="xref">subset_of</a><a href="#section-boilerplate.1-1.4.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.1.2.2">
                    <p id="section-boilerplate.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-one_of-2" class="xref">one_of</a><a href="#section-boilerplate.1-1.4.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.1.2.3">
                    <p id="section-boilerplate.1-1.4.2.1.2.3.1"><a href="#section-4.1.3" class="xref">4.1.3</a>.  <a href="#name-add-2" class="xref">add</a><a href="#section-boilerplate.1-1.4.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.1.2.4">
                    <p id="section-boilerplate.1-1.4.2.1.2.4.1"><a href="#section-4.1.4" class="xref">4.1.4</a>.  <a href="#name-value-2" class="xref">value</a><a href="#section-boilerplate.1-1.4.2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.1.2.5">
                    <p id="section-boilerplate.1-1.4.2.1.2.5.1"><a href="#section-4.1.5" class="xref">4.1.5</a>.  <a href="#name-default-2" class="xref">default</a><a href="#section-boilerplate.1-1.4.2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.1.2.6">
                    <p id="section-boilerplate.1-1.4.2.1.2.6.1"><a href="#section-4.1.6" class="xref">4.1.6</a>.  <a href="#name-essential-2" class="xref">essential</a><a href="#section-boilerplate.1-1.4.2.1.2.6.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.2">
                <p id="section-boilerplate.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-policy-type-combinations-2" class="xref">Policy Type Combinations</a><a href="#section-boilerplate.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.3">
                <p id="section-boilerplate.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-combining-policies-2" class="xref">Combining Policies</a><a href="#section-boilerplate.1-1.4.2.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.3.2.1">
                    <p id="section-boilerplate.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="xref">4.3.1</a>.  <a href="#name-policy-combination-example-2" class="xref">Policy Combination Example</a><a href="#section-boilerplate.1-1.4.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.4">
                <p id="section-boilerplate.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-enforcing-policy-2" class="xref">Enforcing Policy</a><a href="#section-boilerplate.1-1.4.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.5">
                <p id="section-boilerplate.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-extending-the-policy-languag" class="xref">Extending the Policy Language</a><a href="#section-boilerplate.1-1.4.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.4.2.6">
                <p id="section-boilerplate.1-1.4.2.6.1"><a href="#section-4.6" class="xref">4.6</a>.  <a href="#name-policy-example-2" class="xref">Policy Example</a><a href="#section-boilerplate.1-1.4.2.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.5">
            <p id="section-boilerplate.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-the-federation-api-2" class="xref">The Federation API</a><a href="#section-boilerplate.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.5.2.1">
                <p id="section-boilerplate.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-fetching-entity-statement-re" class="xref">Fetching Entity Statement (REQUIRED)</a><a href="#section-boilerplate.1-1.5.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.5.2.1.2.1">
                    <p id="section-boilerplate.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="xref">5.1.1</a>.  <a href="#name-fetch-entity-statements-requ" class="xref">Fetch Entity Statements Request</a><a href="#section-boilerplate.1-1.5.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.5.2.1.2.2">
                    <p id="section-boilerplate.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="xref">5.1.2</a>.  <a href="#name-fetch-entity-statements-resp" class="xref">Fetch Entity Statements Response</a><a href="#section-boilerplate.1-1.5.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.5.2.2">
                <p id="section-boilerplate.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-trust-negotiation-optional-2" class="xref">Trust Negotiation (OPTIONAL)</a><a href="#section-boilerplate.1-1.5.2.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.5.2.2.2.1">
                    <p id="section-boilerplate.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="xref">5.2.1</a>.  <a href="#name-trust-negotiation-request-2" class="xref">Trust Negotiation Request</a><a href="#section-boilerplate.1-1.5.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.5.2.2.2.2">
                    <p id="section-boilerplate.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="xref">5.2.2</a>.  <a href="#name-trust-negotiation-response-2" class="xref">Trust Negotiation Response</a><a href="#section-boilerplate.1-1.5.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.5.2.3">
                <p id="section-boilerplate.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-entity-listings-optional-2" class="xref">Entity Listings (OPTIONAL)</a><a href="#section-boilerplate.1-1.5.2.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.5.2.3.2.1">
                    <p id="section-boilerplate.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="xref">5.3.1</a>.  <a href="#name-entity-listings-request-2" class="xref">Entity Listings Request</a><a href="#section-boilerplate.1-1.5.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.5.2.3.2.2">
                    <p id="section-boilerplate.1-1.5.2.3.2.2.1"><a href="#section-5.3.2" class="xref">5.3.2</a>.  <a href="#name-entity-listing-response-2" class="xref">Entity Listing Response</a><a href="#section-boilerplate.1-1.5.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.5.2.4">
                <p id="section-boilerplate.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-generic-error-response-2" class="xref">Generic Error Response</a><a href="#section-boilerplate.1-1.5.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.6">
            <p id="section-boilerplate.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-resolving-trust-chain-and-me" class="xref">Resolving Trust Chain and Metadata</a><a href="#section-boilerplate.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.6.2.1">
                <p id="section-boilerplate.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-fetching-entity-statements-t" class="xref">Fetching Entity Statements to Establish a Trust Chain</a><a href="#section-boilerplate.1-1.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.6.2.2">
                <p id="section-boilerplate.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-validating-the-trust-chains-2" class="xref">Validating the Trust Chains</a><a href="#section-boilerplate.1-1.6.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.6.2.3">
                <p id="section-boilerplate.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-choosing-one-of-the-valid-tr" class="xref">Choosing One of the Valid Trust Chains</a><a href="#section-boilerplate.1-1.6.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.6.2.4">
                <p id="section-boilerplate.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-calculating-the-lifetime-of-" class="xref">Calculating the Lifetime of a Trust Chain</a><a href="#section-boilerplate.1-1.6.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.7">
            <p id="section-boilerplate.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-updating-metadata-key-rollov" class="xref">Updating Metadata, Key Rollover, and Revocation</a><a href="#section-boilerplate.1-1.7.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.7.2.1">
                <p id="section-boilerplate.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-protocol-key-rollover-2" class="xref">Protocol Key Rollover</a><a href="#section-boilerplate.1-1.7.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.7.2.2">
                <p id="section-boilerplate.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-key-rollover-for-a-trust-anc" class="xref">Key Rollover for a Trust Anchor</a><a href="#section-boilerplate.1-1.7.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.7.2.3">
                <p id="section-boilerplate.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-revocation-2" class="xref">Revocation</a><a href="#section-boilerplate.1-1.7.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.8">
            <p id="section-boilerplate.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-openid-connect-communication" class="xref">OpenID Connect Communication</a><a href="#section-boilerplate.1-1.8.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.8.2.1">
                <p id="section-boilerplate.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-automatic-registration-2" class="xref">Automatic Registration</a><a href="#section-boilerplate.1-1.8.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.8.2.1.2.1">
                    <p id="section-boilerplate.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="xref">8.1.1</a>.  <a href="#name-the-authentication-request-2" class="xref">The Authentication Request</a><a href="#section-boilerplate.1-1.8.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.8.2.1.2.2">
                    <p id="section-boilerplate.1-1.8.2.1.2.2.1"><a href="#section-8.1.2" class="xref">8.1.2</a>.  <a href="#name-processing-the-authenticatio" class="xref">Processing the Authentication Request</a><a href="#section-boilerplate.1-1.8.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.8.2.1.2.3">
                    <p id="section-boilerplate.1-1.8.2.1.2.3.1"><a href="#section-8.1.3" class="xref">8.1.3</a>.  <a href="#name-authentication-error-respons" class="xref">Authentication Error Response</a><a href="#section-boilerplate.1-1.8.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.8.2.2">
                <p id="section-boilerplate.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-explicit-registration-2" class="xref">Explicit Registration</a><a href="#section-boilerplate.1-1.8.2.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.8.2.2.2.1">
                    <p id="section-boilerplate.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="xref">8.2.1</a>.  <a href="#name-provider-discovery-2" class="xref">Provider Discovery</a><a href="#section-boilerplate.1-1.8.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.8.2.2.2.2">
                    <p id="section-boilerplate.1-1.8.2.2.2.2.1"><a href="#section-8.2.2" class="xref">8.2.2</a>.  <a href="#name-client-registration-2" class="xref">Client Registration</a><a href="#section-boilerplate.1-1.8.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.8.2.2.2.3">
                    <p id="section-boilerplate.1-1.8.2.2.2.3.1"><a href="#section-8.2.3" class="xref">8.2.3</a>.  <a href="#name-after-client-registration-2" class="xref">After client registration</a><a href="#section-boilerplate.1-1.8.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.8.2.2.2.4">
                    <p id="section-boilerplate.1-1.8.2.2.2.4.1"><a href="#section-8.2.4" class="xref">8.2.4</a>.  <a href="#name-expiration-times-2" class="xref">Expiration Times</a><a href="#section-boilerplate.1-1.8.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.9">
            <p id="section-boilerplate.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-iana-considerations-2" class="xref">IANA Considerations</a><a href="#section-boilerplate.1-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.10">
            <p id="section-boilerplate.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-security-considerations-2" class="xref">Security Considerations</a><a href="#section-boilerplate.1-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.11">
            <p id="section-boilerplate.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-references-2" class="xref">References</a><a href="#section-boilerplate.1-1.11.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.11.2.1">
                <p id="section-boilerplate.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-normative-references-2" class="xref">Normative References</a><a href="#section-boilerplate.1-1.11.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.11.2.2">
                <p id="section-boilerplate.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-informative-references-2" class="xref">Informative References</a><a href="#section-boilerplate.1-1.11.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.12">
            <p id="section-boilerplate.1-1.12.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-illustrative-example-of-openi" class="xref">Illustrative Example of OpenID Connect Flow Using Automatic Client Registration</a><a href="#section-boilerplate.1-1.12.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.12.2.1">
                <p id="section-boilerplate.1-1.12.2.1.1"><a href="#section-a.1" class="xref">A.1</a>.  <a href="#name-initial-setup-of-foodle-2" class="xref">Initial Setup of Foodle</a><a href="#section-boilerplate.1-1.12.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.12.2.2">
                <p id="section-boilerplate.1-1.12.2.2.1"><a href="#section-a.2" class="xref">A.2</a>.  <a href="#name-federation-setup-2" class="xref">Federation Setup</a><a href="#section-boilerplate.1-1.12.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.12.2.3">
                <p id="section-boilerplate.1-1.12.2.3.1"><a href="#section-a.3" class="xref">A.3</a>.  <a href="#name-user-chooses-to-login-at-foo" class="xref">User Chooses to Login at Foodle</a><a href="#section-boilerplate.1-1.12.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.12.2.4">
                <p id="section-boilerplate.1-1.12.2.4.1"><a href="#section-a.4" class="xref">A.4</a>.  <a href="#name-foodle-discovers-the-op-2" class="xref">Foodle Discovers the OP</a><a href="#section-boilerplate.1-1.12.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.12.2.5">
                <p id="section-boilerplate.1-1.12.2.5.1"><a href="#section-a.5" class="xref">A.5</a>.  <a href="#name-resolving-the-ops-trust-chain" class="xref">Resolving the OP's Trust Chain</a><a href="#section-boilerplate.1-1.12.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.12.2.6">
                <p id="section-boilerplate.1-1.12.2.6.1"><a href="#section-a.6" class="xref">A.6</a>.  <a href="#name-extracting-the-op-metadata-2" class="xref">Extracting the OP metadata</a><a href="#section-boilerplate.1-1.12.2.6.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.12.2.7">
                <p id="section-boilerplate.1-1.12.2.7.1"><a href="#section-a.7" class="xref">A.7</a>.  <a href="#name-rp-sends-authentication-requ" class="xref">RP Sends Authentication Request (Automatic Registration)</a><a href="#section-boilerplate.1-1.12.2.7.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.12.2.8">
                <p id="section-boilerplate.1-1.12.2.8.1"><a href="#section-a.8" class="xref">A.8</a>.  <a href="#name-op-fetches-entity-statements" class="xref">OP Fetches Entity Statements</a><a href="#section-boilerplate.1-1.12.2.8.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.12.2.9">
                <p id="section-boilerplate.1-1.12.2.9.1"><a href="#section-a.9" class="xref">A.9</a>.  <a href="#name-rp-fetches-entity-statements" class="xref">RP Fetches Entity Statements</a><a href="#section-boilerplate.1-1.12.2.9.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.13">
            <p id="section-boilerplate.1-1.13.1"><a href="#section-appendix.b" class="xref">Appendix B</a>.  <a href="#name-illustrative-example-of-openid" class="xref">Illustrative Example of OpenID Connect Flow Using Explicit Client Registration</a><a href="#section-boilerplate.1-1.13.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.1">
                <p id="section-boilerplate.1-1.13.2.1.1"><a href="#section-b.1" class="xref">B.1</a>.  <a href="#name-initial-setup-of-the-eree-se" class="xref">Initial Setup of the EREE Service</a><a href="#section-boilerplate.1-1.13.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.2">
                <p id="section-boilerplate.1-1.13.2.2.1"><a href="#section-b.2" class="xref">B.2</a>.  <a href="#name-researcher-wants-to-start-a-" class="xref">Researcher Wants to Start a Job at the EREE Service</a><a href="#section-boilerplate.1-1.13.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.3">
                <p id="section-boilerplate.1-1.13.2.3.1"><a href="#section-b.3" class="xref">B.3</a>.  <a href="#name-the-eree-rp-discovers-and-in" class="xref">The EREE RP Discovers and Initiates Explicit Registration</a><a href="#section-boilerplate.1-1.13.2.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.3.2.1">
                    <p id="section-boilerplate.1-1.13.2.3.2.1.1"><a href="#section-b.3.1" class="xref">B.3.1</a>.  <a href="#name-the-eree-rp-discovers-the-op" class="xref">The EREE RP Discovers the OpenID Provider</a><a href="#section-boilerplate.1-1.13.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.3.2.2">
                    <p id="section-boilerplate.1-1.13.2.3.2.2.1"><a href="#section-b.3.2" class="xref">B.3.2</a>.  <a href="#name-resolving-the-ops-trust-chain-2" class="xref">Resolving the OP's Trust Chain</a><a href="#section-boilerplate.1-1.13.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.3.2.3">
                    <p id="section-boilerplate.1-1.13.2.3.2.3.1"><a href="#section-b.3.3" class="xref">B.3.3</a>.  <a href="#name-validating-the-trust-chain-3" class="xref">Validating the Trust Chain</a><a href="#section-boilerplate.1-1.13.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.3.2.4">
                    <p id="section-boilerplate.1-1.13.2.3.2.4.1"><a href="#section-b.3.4" class="xref">B.3.4</a>.  <a href="#name-extracting-the-ops-metadata-2" class="xref">Extracting the OP's Metadata</a><a href="#section-boilerplate.1-1.13.2.3.2.4.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.3.2.5">
                    <p id="section-boilerplate.1-1.13.2.3.2.5.1"><a href="#section-b.3.5" class="xref">B.3.5</a>.  <a href="#name-eree-rp-does-federated-clien" class="xref">EREE RP Does Federated Client Registration</a><a href="#section-boilerplate.1-1.13.2.3.2.5.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.4">
                <p id="section-boilerplate.1-1.13.2.4.1"><a href="#section-b.4" class="xref">B.4</a>.  <a href="#name-the-op-processes-a-client-re" class="xref">The OP Processes a Client Registration Request</a><a href="#section-boilerplate.1-1.13.2.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.4.2.1">
                    <p id="section-boilerplate.1-1.13.2.4.2.1.1"><a href="#section-b.4.1" class="xref">B.4.1</a>.  <a href="#name-the-op-gathers-the-rps-trust" class="xref">The OP Gathers the RPs Trust Chains</a><a href="#section-boilerplate.1-1.13.2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.4.2.2">
                    <p id="section-boilerplate.1-1.13.2.4.2.2.1"><a href="#section-b.4.2" class="xref">B.4.2</a>.  <a href="#name-validating-the-trust-chain-4" class="xref">Validating the Trust Chain</a><a href="#section-boilerplate.1-1.13.2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.4.2.3">
                    <p id="section-boilerplate.1-1.13.2.4.2.3.1"><a href="#section-b.4.3" class="xref">B.4.3</a>.  <a href="#name-extracting-rp-metadata-2" class="xref">Extracting RP Metadata</a><a href="#section-boilerplate.1-1.13.2.4.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.4.2.4">
                    <p id="section-boilerplate.1-1.13.2.4.2.4.1"><a href="#section-b.4.4" class="xref">B.4.4</a>.  <a href="#name-constructing-the-registratio" class="xref">Constructing the Registration Response</a><a href="#section-boilerplate.1-1.13.2.4.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.1-1.13.2.5">
                <p id="section-boilerplate.1-1.13.2.5.1"><a href="#section-b.5" class="xref">B.5</a>.  <a href="#name-the-rp-processes-the-registr" class="xref">The RP Processes the Registration Response</a><a href="#section-boilerplate.1-1.13.2.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.14">
            <p id="section-boilerplate.1-1.14.1"><a href="#section-appendix.c" class="xref">Appendix C</a>.  <a href="#name-notices-2" class="xref">Notices</a><a href="#section-boilerplate.1-1.14.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.15">
            <p id="section-boilerplate.1-1.15.1"><a href="#section-appendix.d" class="xref">Appendix D</a>.  <a href="#name-acknowledgements-2" class="xref">Acknowledgements</a><a href="#section-boilerplate.1-1.15.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.16">
            <p id="section-boilerplate.1-1.16.1"><a href="#section-appendix.e" class="xref">Appendix E</a>.  <a href="#name-open-issues-2" class="xref">Open Issues</a><a href="#section-boilerplate.1-1.16.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.17">
            <p id="section-boilerplate.1-1.17.1"><a href="#section-appendix.f" class="xref">Appendix F</a>.  <a href="#name-document-history-2" class="xref">Document History</a><a href="#section-boilerplate.1-1.17.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.1-1.18">
            <p id="section-boilerplate.1-1.18.1"><a href="#section-appendix.g" class="xref"></a>  <a href="#name-authors-addresses-2" class="xref">Authors' Addresses</a><a href="#section-boilerplate.1-1.18.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="Introduction">
<section id="section-1">
      <h2 id="name-introduction-2">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction-2" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
 This specification describes how two entities that would like to
        interact can dynamically fetch and resolve trust and metadata for a
        given protocol through the use of third-party trust issuers. A trust
        issuer is an entity whose main purpose is to issue statements
        about entities, such as OpenID Connect Relying Parties, OpenID Providers,
 and participating organizations.
 An identity
        federation can be realized using this specification using one or
        more levels of trust issuers. This specification does not mandate a
        specific way or restrict how a federation may be built. Instead, the
        specification provides the basic technical trust infrastructure building
        blocks needed to build a dynamic and distributed trust network such as a
        federation.
      <a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
 All entities in an OpenID Connect federation MUST have a globally
        unique identifier.
      <a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">
 Note that a company, as with any real-world organization, may be
        represented by more than one entity in a federation.
      <a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">
 OpenID Connect Federation trust chains rely on
        cryptographically signed <span><a href="#RFC7519" class="xref">JSON Web Token (JWT)</a> [<a href="#RFC7519" class="xref">RFC7519</a>]</span> documents, and the trust chain does not at
        all rely on TLS <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span> in order to establish trust.
      <a href="#section-1-4" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-language-2">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language-2" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">
   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
          "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
          document are to be interpreted as described in <span><a href="#RFC2119" class="xref">RFC 2119</a> [<a href="#RFC2119" class="xref">RFC2119</a>]</span>.
        <a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-1.2">
        <h3 id="name-terminology-2">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology-2" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.2-1">
          This specification uses the terms
          "Claim Name", "Claim Value", "JSON Web Token (JWT)",
          defined by <span><a href="#RFC7519" class="xref">JSON Web Token (JWT)</a> [<a href="#RFC7519" class="xref">RFC7519</a>]</span>
   and the terms "OpenID Provider (OP)" and "Relying Party (RP)" defined by
          <span><a href="#OpenID.Core" class="xref">OpenID Connect Core 1.0</a> [<a href="#OpenID.Core" class="xref">OpenID.Core</a>]</span>.
        <a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">
          This specification also defines the following terms:
        <a href="#section-1.2-2" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-1.2-3">
          <dt id="section-1.2-3.1">Entity</dt>
          <dd id="section-1.2-3.2">
              Something that has a separate and distinct existence and that can
              be identified in a context.
            </dd>
          <dt id="section-1.2-3.3">Entity statement</dt>
          <dd id="section-1.2-3.4">
              An entity statement is
              issued by an entity, which pertains to a subject entity and leaf
              entities. An entity statement is always a signed JWT.
            </dd>
          <dt id="section-1.2-3.5">Intermediate entity</dt>
          <dd id="section-1.2-3.6">
              An entity that issues
              an entity statement that appears somewhere in between those
              issued by the trust anchor and the leaf entity in a trust chain.
            </dd>
          <dt id="section-1.2-3.7">Leaf Entity</dt>
          <dd id="section-1.2-3.8">
              An entity defined by a certain protocol,
       e.g., OpenID Connect Relying Party or Provider.
            </dd>
          <dt id="section-1.2-3.9">Trust Anchor</dt>
          <dd id="section-1.2-3.10">
              An entity that represents a trusted third party.
            </dd>
          <dt id="section-1.2-3.11">Trust Chain</dt>
          <dd id="section-1.2-3.12">
              A sequence of entity statements that represents a trusted chain
              starting at a leaf entity and ending in a trust anchor.
            </dd>
        </dl>
</section>
</section>
</div>
<div id="components">
<section id="section-2">
      <h2 id="name-components-2">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-components-2" class="section-name selfRef">Components</a>
      </h2>
<div id="entity-statement">
<section id="section-2.1">
        <h3 id="name-entity-statement-2">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-entity-statement-2" class="section-name selfRef">Entity Statement</a>
        </h3>
<p id="section-2.1-1">
   An entity statement is
          issued by an entity and concerns a subject entity and leaf entities
          in a federation. An entity statement is always a signed JWT.
          All entities in a federation MUST be prepared to publish an entity
          statement about themselves.
        <a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">
          An entity statement is composed of the following claims:
        <a href="#section-2.1-2" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-2.1-3">
          <dt id="section-2.1-3.1">iss</dt>
          <dd id="section-2.1-3.2">
       REQUIRED. The entity identifier of the issuer of
              the statement. If the <code>iss</code> and
              the <code>sub</code> are identical, the
              issuer is making a statement about itself.
            </dd>
          <dt id="section-2.1-3.3">sub</dt>
          <dd id="section-2.1-3.4">
       REQUIRED. The entity identifier of the subject
     </dd>
          <dt id="section-2.1-3.5">iat</dt>
          <dd id="section-2.1-3.6">
       REQUIRED. The time the statement was issued.
              Its value is a JSON number representing the number of seconds from
              1970-01-01T0:0:0Z as measured in UTC until the date/time.
              See <span><a href="#RFC3339" class="xref">RFC 3339</a> [<a href="#RFC3339" class="xref">RFC3339</a>]</span> for
              details regarding date/times in general and UTC in particular.
            </dd>
          <dt id="section-2.1-3.7">exp</dt>
          <dd id="section-2.1-3.8">
       REQUIRED.
              Expiration time on or after which the statement MUST NOT be
              accepted for processing. Its value is a JSON number representing
              the number of seconds from 1970-01-01T0:0:0Z as measured in UTC
              until the date/time.
            </dd>
          <dt id="section-2.1-3.9">jwks</dt>
          <dd id="section-2.1-3.10">
       REQUIRED. A <span><a href="#RFC7517" class="xref">JSON Web Key Set (JWKS)</a> [<a href="#RFC7517" class="xref">RFC7517</a>]</span>
       representing the public part of the subject
              entity's signing keys. The corresponding private key is
              used by leaf entities to sign entity statements about themselves,
              and intermediate entities to sign statements about other entities.
              The keys that can be found here are primarily intended to sign
              entity statements and should not be used in other protocols.
            </dd>
          <dt id="section-2.1-3.11">aud</dt>
          <dd id="section-2.1-3.12">
       OPTIONAL.
              The entity statement may be specifically created for a entity.
              The entity identifier for that entity should appear in this claim.
            </dd>
          <dt id="section-2.1-3.13">authority_hints</dt>
          <dd id="section-2.1-3.14">
       OPTIONAL. A JSON object where the keys
              are the entity IDs of the intermediate entities that may issue an
              entity statement about the issuer entity. The value MUST be a
              JSON array of entities that are further up in the trust chain.
              The array may be an empty list.
              The JSON array can be used to simplify the selection of trust
              chains without the need for following all possible trust chains.
       <code>authority_hints</code> values
       may be multiple hops up the chain.
       These values will typically be trust anchors.
            </dd>
          <dt id="section-2.1-3.15">metadata</dt>
          <dd id="section-2.1-3.16">
       OPTIONAL. JSON object including protocol
              specific metadata claims that represent the entity's metadata.
              Each key of the JSON object represents a metadata type
              identifier, and each value MUST be a JSON object representing
              the metadata according to the metadata schema of that metadata
              type. An entity statement may contain multiple
              metadata statements, but only one for each metadata type.
            </dd>
          <dt id="section-2.1-3.17">metadata_policy</dt>
          <dd id="section-2.1-3.18">
       OPTIONAL. JSON object that describes
              a metadata policy.
              Each key of the JSON object represents a metadata type
              identifier, and each value MUST be a JSON object representing
              the metadata policy according to the metadata schema of that metadata
              type. An entity statement may contain multiple
              metadata policy statements, but only one for each metadata type.
              If the metadata type identifier is
              <code>federation_entity</code>, then the policy
              MUST be applied to the immediate subordinate in the trust chain
              unless that is a leaf entity.
       If the metadata type identifier is not
              <code>federation_entity</code>, then the policy
       MUST be applied to all subordinate nodes of that type in the trust chain.
       Only non-leaf entities contain a <code>metadata_policy</code> field.
            </dd>
          <dt id="section-2.1-3.19">crit</dt>
          <dd id="section-2.1-3.20">
       OPTIONAL.
       The <code>crit</code> (critical) entity statement claim
       indicates that extensions to entity statement claims defined by this specification
       are being used that MUST be understood and processed.
       It is used in the same way that <code>crit</code>
       is used for extension JWS header parameters that MUST be understood and processed.
       Its value is an array listing the entity statement claims
       present in the entity statement that use those extensions.
       If any of the listed extension entity statement claims are not
       understood and supported by the recipient, then the entity statement is invalid.
       Producers MUST NOT include entity statement claim names defined by this specification or
       names that do not occur as entity statement claim names in the entity statement
       in the <code>crit</code> list.
       Producers MUST NOT use the empty list <code>[]</code>
       as the <code>crit</code> value.
     </dd>
          <dt id="section-2.1-3.21">policy_language_crit</dt>
          <dd id="section-2.1-3.22">
       OPTIONAL.
       The <code>policy_language_crit</code> (critical) entity statement claim
       indicates that extensions to the policy language defined by this specification
       are being used that MUST be understood and processed.
       It is used in the same way that <code>crit</code>
       is used for extension JWS header parameters that MUST be understood and processed.
       Its value is an array listing the policy language extensions
       present in the policy language statements that use those extensions.
       If any of the listed extension policy language extensions are not
       understood and supported by the recipient, then the entity statement is invalid.
       Producers MUST NOT include policy language names defined by this specification or
       names that do not occur in policy language statements in the entity statement
       in the <code>policy_language_crit</code> list.
       Producers MUST NOT use the empty list <code>[]</code>
       as the <code>policy_language_crit</code> value.
     </dd>
        </dl>
<p id="section-2.1-4">
   The entity statement is signed using the private key of the issuer
          entity, in the form of a <span><a href="#RFC7515" class="xref">JSON Web Signature (JWS)</a> [<a href="#RFC7515" class="xref">RFC7515</a>]</span>.
        <a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">
     The following is a non-normative example of an entity statement, before
            serialization and adding a signature.  The example contains
            a critical extension <code>jti</code> (JWT ID) to the
            entity statement and one critical extension to the policy language
            <code>regexp</code> (Regular expression).
        <a href="#section-2.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-2.1-6">
<pre>
{
  "iss": "https://feide.no",
  "sub": "https://ntnu.no",
  "iat": 1516239022,
  "exp": 1516298022,
  "crit": ["jti"],
  "jti": "7l2lncFdY6SlhNia",
  "policy_language_crit": [regexp"],
  "metadata_policy": {
    "openid_provider": {
      "issuer": {"value": "https://ntnu.no"},
      "organization_name": {"value": "NTNU"},
      "id_token_signing_alg_values_supported":
        {"subset_of": ["RS256", "RS384", "RS512"]},
      "op_policy_uri": {
        "regexp": "^https:\/\/[\w-]+\.example\.com\/[\w-]+\.html"}
    },
    "openid_relying_party": {
      "organization_name": {"value": "NTNU"},
      "grant_types_supported": {
        "subset_of": ["authorization_code", "implicit"]},
      "scopes": {
        "subset_of": ["openid", "profile", "email", "phone"]}
    }
  },
  "jwks": {
    "keys": [
      {
        "alg": "RS256",
        "e": "AQAB",
        "ext": true,
        "key_ops": ["verify"],
        "kid": "key1",
        "kty": "RSA",
        "n": "pnXBOusEANuug6ewezb9J_...",
        "use": "sig"
      }
    ]
  },
  "authority_hints": {
    "https://edugain.org/federation": [
      "https://edugain.org/federation"
    ]
  }
}
</pre>
<a href="#section-2.1-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="trust_chain">
<section id="section-2.2">
        <h3 id="name-trust-chain-2">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-trust-chain-2" class="section-name selfRef">Trust Chain</a>
        </h3>
<p id="section-2.2-1">
          In an OpenID Connect Identity Federation, entities that together build a
          trust chain can be categorized as:
        <a href="#section-2.2-1" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-2.2-2">
          <dt id="section-2.2-2.1">Trust anchor</dt>
          <dd id="section-2.2-2.2">
       An entity that represents a trusted
              third party
            </dd>
          <dt id="section-2.2-2.3">Leaf</dt>
          <dd id="section-2.2-2.4">
       In an OpenID Connect Identity Federation, an RP or an OP
            </dd>
          <dt id="section-2.2-2.5">Intermediate</dt>
          <dd id="section-2.2-2.6">
       Neither a leaf nor a trust anchor
     </dd>
        </dl>
<p id="section-2.2-3">
          A trust chain begins with a leaf entity's self-signed entity
          statement, has zero or more entity statements
          issued by intermediates about subordinates, and ends with an
          entity statement issued by the trust anchor about the top-most
          intermediate (if there are intermediates) or the leaf entity
          (if there are no intermediates)
          and finally a self-signed entity statement about the trust anchor.
        <a href="#section-2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2-4">
   A simple example: If we have an RP that belongs to organization A
          that is a member of federation F, the trust chain for such a setup
          will contain the following entity statements:
        <a href="#section-2.2-4" class="pilcrow">¶</a></p>
<ol type="1" start="1" class="normal" id="section-2.2-5">
          <li id="section-2.2-5.1">
              A self-signed entity statement about the RP published by the RP
            <a href="#section-2.2-5.1" class="pilcrow">¶</a>
</li>
          <li id="section-2.2-5.2">
              An entity statement about the RP published by Organization A
            <a href="#section-2.2-5.2" class="pilcrow">¶</a>
</li>
          <li id="section-2.2-5.3">
              An entity statement about Organization A published by Federation
              F
            <a href="#section-2.2-5.3" class="pilcrow">¶</a>
</li>
          <li id="section-2.2-5.4">
              A self-signed entity statement about Federation F published
              by Federation F.
            <a href="#section-2.2-5.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-2.2-6">
          A trust chain MUST always be possible to order such that:
          If we name the entity statements ES[0] (the leaf entity's
          self-signed entity statement) to ES[i] (the trust anchors
          self-signed entity statement), i&gt;0 then:
        <a href="#section-2.2-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-2.2-7.1">
              The <code>iss</code> entity in one entity statement is always the <code>sub</code>
              entity in the next.
              ES[j]['iss'] == ES[j+1]['sub'], j=0,...,i-1
            <a href="#section-2.2-7.1" class="pilcrow">¶</a>
</li>
          <li id="section-2.2-7.2">
              There MUST always be a signing key carried in the
              <code>jwks</code> claim in
              ES[j] that can be used to verify the signature of ES[j-1],
              j=i,...,1 .
            <a href="#section-2.2-7.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.2-8">
          The signing key that MUST be used to verify ES[i] is distributed
          from the trust anchors to the leaf entities in
          some secure out-of-band's way not described in this document.
        <a href="#section-2.2-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="metadata">
<section id="section-3">
      <h2 id="name-metadata-2">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-metadata-2" class="section-name selfRef">Metadata</a>
      </h2>
<p id="section-3-1">
 This specification does allow new metadata
        types to be defined, to support use cases outside OpenID Connect federations.
 The metadata type identifier will uniquely identify which metadata
        specification to utilize.
      <a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">
 The metadata document MUST be a JSON document. Beyond that there is
        no restriction.
      <a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">
 Metadata used in federations typically re-uses existing metadata standards.
 If needed, the metadata schema is extended
        with additional properties relevant in a federated context.
 For instance, for OpenID Connect Federations, this specification uses
 metadata values from
 <span><a href="#OpenID.Discovery" class="xref">OpenID Connect Discovery 1.0</a> [<a href="#OpenID.Discovery" class="xref">OpenID.Discovery</a>]</span> and
 <span><a href="#OpenID.Registration" class="xref">OpenID Connect Dynamic Client Registration 1.0</a> [<a href="#OpenID.Registration" class="xref">OpenID.Registration</a>]</span>
 and adds additional values used for federations.
      <a href="#section-3-3" class="pilcrow">¶</a></p>
<div id="RP_metadata">
<section id="section-3.1">
        <h3 id="name-rp-metadata-2">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-rp-metadata-2" class="section-name selfRef">RP Metadata</a>
        </h3>
<p id="section-3.1-1">
   The metadata type identifier is
   <code>openid_relying_party</code>.
        <a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">
   All parameters defined in Section 2 of
   <span><a href="#OpenID.Registration" class="xref">OpenID Connect Dynamic Client Registration 1.0</a> [<a href="#OpenID.Registration" class="xref">OpenID.Registration</a>]</span>
   are allowed in a metadata statement.
        <a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">
   To that list is added:
        <a href="#section-3.1-3" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-3.1-4">
          <dt id="section-3.1-4.1">federation_type</dt>
          <dd id="section-3.1-4.2">
       REQUIRED.  String specifying the federation type being used.
       Values defined by this specification are
       <code>automatic</code> and <code>explicit</code>.
     </dd>
          <dt id="section-3.1-4.3">organization_name</dt>
          <dd id="section-3.1-4.4">
       OPTIONAL. A human readable
              name representing the organization owning the RP.
            </dd>
        </dl>
</section>
</div>
<div id="OP_metadata">
<section id="section-3.2">
        <h3 id="name-op-metadata-2">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-op-metadata-2" class="section-name selfRef">OP Metadata</a>
        </h3>
<p id="section-3.2-1">
   The metadata type identifier is
   <code>openid_provider</code>.
        <a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">
   All parameters defined in Section 3 of
          <span><a href="#OpenID.Discovery" class="xref">OpenID Connect Discovery 1.0</a> [<a href="#OpenID.Discovery" class="xref">OpenID.Discovery</a>]</span>
   are applicable.
        <a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">
   In addition, the following parameters are defined by this specification:
        <a href="#section-3.2-3" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-3.2-4">
          <dt id="section-3.2-4.1">federation_types_supported</dt>
          <dd id="section-3.2-4.2">
       REQUIRED.  Array specifying the federation types supported.
       Federation type values defined by this specification are
       <code>automatic</code> and <code>explicit</code>.
     </dd>
          <dt id="section-3.2-4.3">organization_name</dt>
          <dd id="section-3.2-4.4">
       OPTIONAL. A human readable
              name representing the organization owning the OP. It is
              intended to be used in the user interface, being recognized by
              the end users that would be using the OP to authenticate.
            </dd>
          <dt id="section-3.2-4.5">federation_registration_endpoint</dt>
          <dd id="section-3.2-4.6">
       OPTIONAL.
              URL of the OP's Federation specific Dynamic Client Registration
              Endpoint. If the OP supports explicit client
              registration as described in <a href="#explicit" class="xref">Section 8.2</a>,
       then this claim is REQUIRED.
            </dd>
        </dl>
</section>
</div>
<section id="section-3.3">
        <h3 id="name-oauth-authorization-server-2">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-oauth-authorization-server-2" class="section-name selfRef">OAuth Authorization Server</a>
        </h3>
<p id="section-3.3-1">
   The metadata type identifier is
          <code>oauth_authorization_server</code>.
        <a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">
   All parameters defined in Section 2 of
          <span><a href="#RFC8414" class="xref">RFC 8414</a> [<a href="#RFC8414" class="xref">RFC8414</a>]</span>
   are applicable.
        <a href="#section-3.3-2" class="pilcrow">¶</a></p>
</section>
<section id="section-3.4">
        <h3 id="name-oauth-client-2">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-oauth-client-2" class="section-name selfRef">OAuth Client</a>
        </h3>
<p id="section-3.4-1">
   The metadata type identifier is
   <code>oauth_client</code>.
        <a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">
   All parameters defined in Section 2 of
          <span><a href="#RFC7591" class="xref">RFC 7591</a> [<a href="#RFC7591" class="xref">RFC7591</a>]</span>
        <a href="#section-3.4-2" class="pilcrow">¶</a></p>
</section>
<section id="section-3.5">
        <h3 id="name-oauth-protected-resource-2">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-oauth-protected-resource-2" class="section-name selfRef">OAuth Protected Resource</a>
        </h3>
<p id="section-3.5-1">
   The metadata type identifier is
          <code>oauth_resource</code>.
        <a href="#section-3.5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.6">
        <h3 id="name-federation-entity-2">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-federation-entity-2" class="section-name selfRef">Federation Entity</a>
        </h3>
<p id="section-3.6-1">
   The metadata type identifier is
          <code>federation_entity</code>.
        <a href="#section-3.6-1" class="pilcrow">¶</a></p>
<p id="section-3.6-2">
   Intermediates in a trust chain are of this type.
        <a href="#section-3.6-2" class="pilcrow">¶</a></p>
<p id="section-3.6-3">
          Note that the information carried here is not bound to any
          specific protocol but of a general nature.
        <a href="#section-3.6-3" class="pilcrow">¶</a></p>
<p id="section-3.6-4">
          The following properties are allowed:
        <a href="#section-3.6-4" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-3.6-5">
          <dt id="section-3.6-5.1">name</dt>
          <dd id="section-3.6-5.2">
       OPTIONAL. String. The human readable name
              describing the subject entity. This may be, for example, the
              name of an organization.
            </dd>
          <dt id="section-3.6-5.3">contacts</dt>
          <dd id="section-3.6-5.4">
       OPTIONAL. JSON array with one or more
              strings. Contact persons at the entity.
       These may contain names, e-mail addresses, descriptions, phone numbers, etc.
            </dd>
          <dt id="section-3.6-5.5">policy_uri</dt>
          <dd id="section-3.6-5.6">
       OPTIONAL. URL to documentation of
              conditions and policies relevant to this entity.
            </dd>
          <dt id="section-3.6-5.7">homepage_uri</dt>
          <dd id="section-3.6-5.8">
       OPTIONAL. URL to a generic home page
              representing this entity.
            </dd>
        </dl>
</section>
</section>
</div>
<section id="section-4">
      <h2 id="name-applying-policy-to-metadata-2">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-applying-policy-to-metadata-2" class="section-name selfRef">Applying Policy to Metadata</a>
      </h2>
<p id="section-4-1">
 The metadata for a specific entity can be constructed by starting
        with the information in leaf entity's entity statement and then
        applying the polices defined by the trust anchor and possible
        intermediates starting with the trust anchor.
      <a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="PolicyLanguage">
<section id="section-4.1">
        <h3 id="name-policy-language-2">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-policy-language-2" class="section-name selfRef">Policy Language</a>
        </h3>
<p id="section-4.1-1">
          Policies are expressed using a JSON object.
        <a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">
          The following keywords represent different
          actions/checks that MUST be applied to the metadata.
        <a href="#section-4.1-2" class="pilcrow">¶</a></p>
<div id="subset_of">
<section id="section-4.1.1">
          <h4 id="name-subset_of-2">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-subset_of-2" class="section-name selfRef">subset_of</a>
          </h4>
<p id="section-4.1.1-1">
     The resulting value of the claim will be the intersection of the
     values specified here and the values of the claim. For
     instance, the claim policy:
          <a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.1-2">
<pre>
  "response_types": {
    "subset_of": ["code", "code token", "code id_token"]}
</pre>
<a href="#section-4.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1-3">
     if applied to a metadata statement with:
          <a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.1-4">
<pre>
  "response_types": ["code", "code id_token token", "code id_token"]
</pre>
<a href="#section-4.1.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1-5">
     will update the claim in the metadata statement to be:
          <a href="#section-4.1.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.1-6">
<pre>
  "response_types": ["code", "code id_token"]
</pre>
<a href="#section-4.1.1-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="one_of">
<section id="section-4.1.2">
          <h4 id="name-one_of-2">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-one_of-2" class="section-name selfRef">one_of</a>
          </h4>
<p id="section-4.1.2-1">
     The value of the claim MUST be one of the ones listed here.
     As an example, if the claim policy:
          <a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.2-2">
<pre>
  "request_object_signing_alg": {
    "one_of": ["ES256", "ES384", "ES512"]}
</pre>
<a href="#section-4.1.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1.2-3">
     is applied to the metadata statement
          <a href="#section-4.1.2-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.2-4">
<pre>
  "request_object_signing_alg": "ES384"
</pre>
<a href="#section-4.1.2-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1.2-5">
     the resulting claim statement will be:
          <a href="#section-4.1.2-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.2-6">
<pre>
  "request_object_signing_alg": "ES384"
</pre>
<a href="#section-4.1.2-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="add">
<section id="section-4.1.3">
          <h4 id="name-add-2">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-add-2" class="section-name selfRef">add</a>
          </h4>
<p id="section-4.1.3-1">
     Adds the value or values specified to the list of values for the
     metadata statement claim.
     If the specified value is already present in the list,
     this operation has no effect.
     As an example, if the claim policy:
          <a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.3-2">
<pre>
  "contacts": {
    "add": "support@federation.example.com"}
</pre>
<a href="#section-4.1.3-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1.3-3">
     is applied to the following claim in the metadata statement:
          <a href="#section-4.1.3-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.3-4">
<pre>
  "contacts": "support@org.example.com"
</pre>
<a href="#section-4.1.3-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1.3-5">
     the end result will be the claim:
          <a href="#section-4.1.3-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.3-6">
<pre>
  "contacts": ["support@org.example.com",
               "support@federation.example.com"]
</pre>
<a href="#section-4.1.3-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="value">
<section id="section-4.1.4">
          <h4 id="name-value-2">
<a href="#section-4.1.4" class="section-number selfRef">4.1.4. </a><a href="#name-value-2" class="section-name selfRef">value</a>
          </h4>
<p id="section-4.1.4-1">
     Disregarding what value the claim had,
     if any, the claims value will be set to what is specified here.
     As an example, if the claim policy:
          <a href="#section-4.1.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.4-2">
<pre>
  "require_auth_time": {
    "value": true}
</pre>
<a href="#section-4.1.4-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1.4-3">
     is applied to a metadata statement with no such claim
     the result will be that the metadata statement after applying the
     policy contains the claim:
          <a href="#section-4.1.4-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.4-4">
<pre>
  "require_auth_time": true
</pre>
<a href="#section-4.1.4-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="default">
<section id="section-4.1.5">
          <h4 id="name-default-2">
<a href="#section-4.1.5" class="section-number selfRef">4.1.5. </a><a href="#name-default-2" class="section-name selfRef">default</a>
          </h4>
<p id="section-4.1.5-1">
     If no value is assigned to this claim, then the claim's value
     will be set to what is specified here.
     As an example, if the claim policy:
          <a href="#section-4.1.5-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.5-2">
<pre>
  "require_auth_time": {
    "default": true }
</pre>
<a href="#section-4.1.5-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1.5-3">
     is applied to a metadata statement with the claim
          <a href="#section-4.1.5-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.5-4">
<pre>
  "require_auth_time": false
</pre>
<a href="#section-4.1.5-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1.5-5">
     then the metadata statement will afterwards contain:
          <a href="#section-4.1.5-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.5-6">
<pre>
  "require_auth_time": false
</pre>
<a href="#section-4.1.5-6" class="pilcrow">¶</a>
</div>
<p id="section-4.1.5-7">
     if on the other hand the metadata statement did not contain a
     <code>require_auth_time</code> claim then the
     following claim statement would be added to the metadata
     statement:
          <a href="#section-4.1.5-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.5-8">
<pre>
  "require_auth_time": true
</pre>
<a href="#section-4.1.5-8" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="essential">
<section id="section-4.1.6">
          <h4 id="name-essential-2">
<a href="#section-4.1.6" class="section-number selfRef">4.1.6. </a><a href="#name-essential-2" class="section-name selfRef">essential</a>
          </h4>
<p id="section-4.1.6-1">
     If 'true' then claim MUST have a value. <code>essential</code> can be
     combined with all the other types.
          <a href="#section-4.1.6-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.6-2">
<pre>
  "tos_uri": {
    "essential": true}
</pre>
<a href="#section-4.1.6-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1.6-3">
     The upshot of applying this policy to a metadata statement
     is that the metadata statement MUST contain such a claim
     otherwise the metadata statement is incorrect.
          <a href="#section-4.1.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-4.2">
        <h3 id="name-policy-type-combinations-2">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-policy-type-combinations-2" class="section-name selfRef">Policy Type Combinations</a>
        </h3>
<p id="section-4.2-1">
          Some policy types can be combined with others.
        <a href="#section-4.2-1" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-4.2-2">
          <dt id="section-4.2-2.1">default</dt>
          <dd id="section-4.2-2.2">
              Can be combined with <code>one_of</code> and
              <code>subset_of</code>.
            </dd>
          <dt id="section-4.2-2.3">essential</dt>
          <dd id="section-4.2-2.4">
              Can be combined with all the others. If
              <code>essential</code> is not present that is
              the same as stating essential=true.
            </dd>
        </dl>
</section>
<section id="section-4.3">
        <h3 id="name-combining-policies-2">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-combining-policies-2" class="section-name selfRef">Combining Policies</a>
        </h3>
<p id="section-4.3-1">
          If there is more than one metadata policy in a trust chain, then
          the policies MUST be combined before they are applied to the
          metadata statement.
        <a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">
   Using the notation we have previously defined metadata policies
          are combined starting with ES[i] and then adding the policies from
          ES[j] j=i-1,..,1 before applying the combined policy to the entity's
          metadata
        <a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">
          These are the policy types that can be combined when combining 2
          policies:
        <a href="#section-4.3-3" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-4.3-4">
          <dt id="section-4.3-4.1">subset_of</dt>
          <dd id="section-4.3-4.2">
              The result of combining 2 <code>subset_of</code> policies is the intersection of
              the values.
            </dd>
          <dt id="section-4.3-4.3">one_of</dt>
          <dd id="section-4.3-4.4">
              The result of combining 2 <code>one_of</code> policies is the intersection of
              the values.
            </dd>
          <dt id="section-4.3-4.5">add</dt>
          <dd id="section-4.3-4.6">
              The result of combining 2 <code>add</code> policies is the union of the
              values.
            </dd>
        </dl>
<p id="section-4.3-5">
          All the other policy types can NOT be combined. Which means that
          whatever a superior specifies are what goes.
        <a href="#section-4.3-5" class="pilcrow">¶</a></p>
<section id="section-4.3.1">
          <h4 id="name-policy-combination-example-2">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-policy-combination-example-2" class="section-name selfRef">Policy Combination Example</a>
          </h4>
<p id="section-4.3.1-1">
       A federations policy for RPs:
          <a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.3.1-2">
<pre>
{
  "scopes": {
    "subset_of": ["openid", "eduperson", "phone"],
    "default": ["openid", "eduperson"]},
  "id_token_signed_response_alg": {
    "one_of": ["ES256", "ES384", "ES512"],
    "default": "ES256"},
  "contacts: {
    "add": "helpdesk@federation.example.org"},
   "application_type": {
    "value": "web"}
}
</pre>
<a href="#section-4.3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1-3">
       An organization's policy for RPs:
          <a href="#section-4.3.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.3.1-4">
<pre>
{
  "scopes": {
    "subset_of": ["openid", "eduperson", "address"],
    "default": ["openid", "eduperson"]},
  "id_token_signed_response_alg": {
    "one_of": ["ES256", "ES384"],
    "default": "ES256"},
  "contacts: {
    "add": "helpdesk@org.example.org"},
  "application_type": {
    "one_of": ["web", "native"]}
}
</pre>
<a href="#section-4.3.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1-5">
       The combined metadata policy then becomes:
          <a href="#section-4.3.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.3.1-6">
<pre>
{
  "scopes": {
    "subset_of": ["openid", "eduperson"],
    "default": ["openid", "eduperson"]},
  "id_token_signed_response_alg": {
    "one_of": ["ES256", "ES384"],
    "default": "ES256"},
  "contacts: {
    "add": ["helpdesk@federation.example.org"],
            "helpdesk@org.example.org"]},
  "application_type": {
    "value": "web"}
}
</pre>
<a href="#section-4.3.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1-7">
            If after combining a <code>default</code> value for a claim policy,
     the result is not a
            subset of a <code>subset_of</code> policy or a
            <code>one_of</code> defined for that claim, then an
            error MUST be raised and the trust chain NOT used.
          <a href="#section-4.3.1-7" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-4.4">
        <h3 id="name-enforcing-policy-2">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-enforcing-policy-2" class="section-name selfRef">Enforcing Policy</a>
        </h3>
<p id="section-4.4-1">
          If applying a policy to a metadata statement results in some claims
          having all their values removed and it is essential that a
          claim has a value, then such a metadata statement MUST
          be regarded as broken and MUST NOT be used.
        <a href="#section-4.4-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.5">
        <h3 id="name-extending-the-policy-languag">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-extending-the-policy-languag" class="section-name selfRef">Extending the Policy Language</a>
        </h3>
<p id="section-4.5-1">
          There might be parties that wants to extend the policy language
          defined here. If that happens then the rule is that if
          software compliant with this specification
          encounters a keyword it doesn't understand it MUST ignore it
   unless it is listed in a <code>policy_language_crit</code> list,
   as is done for JWS header parameters with the <code>crit</code> parameter.
   If the policy language extension keyword
   is listed in the <code>policy_language_crit</code> list
   and not understood, then the metadata MUST be rejected.
        <a href="#section-4.5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.6">
        <h3 id="name-policy-example-2">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-policy-example-2" class="section-name selfRef">Policy Example</a>
        </h3>
<p id="section-4.6-1">
          The following is a non-normative example of a set of policies being
          applied to an RP's metadata.
        <a href="#section-4.6-1" class="pilcrow">¶</a></p>
<p id="section-4.6-2">
     The RP's metadata:
        <a href="#section-4.6-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.6-3">
<pre>
{
  "contacts": ["rp_admins@cs.example.com"],
  "redirect_uris": ["https://cs.example.com/rp1"],
  "response_types: ["code"]
}
</pre>
<a href="#section-4.6-3" class="pilcrow">¶</a>
</div>
<p id="section-4.6-4">
     The federations policy for RPs:
        <a href="#section-4.6-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.6-5">
<pre>
{
  "scopes": {
    "subset_of": ["openid", "eduperson"]},
  "response_types": {
    "subset_of": ["code", "code id_token"]}
}
</pre>
<a href="#section-4.6-5" class="pilcrow">¶</a>
</div>
<p id="section-4.6-6">
     The organization's policy for RPs:
        <a href="#section-4.6-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.6-7">
<pre>
{
  "contacts": {
    "add": "helpdesk@example.com"},
  "logo_uri": {
    "one_of": ["https://example.com/logo_small.jpg",
               "https://example.com/logo_big.jpg"],
    "default": "https://example.com/logo_small.jpg"
  },
  "policy_uri": {
    "value": "https://example.com/policy.html"},
  "tos_uri": {
    "value": "https://example.com/tos.html"}
}
</pre>
<a href="#section-4.6-7" class="pilcrow">¶</a>
</div>
<p id="section-4.6-8">
          The metadata for the entity in question after applying the policies
          above, would then become:
        <a href="#section-4.6-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.6-9">
<pre>{
  "contacts": ["rp_admins@cs.example.com", "helpdesk@example.com"],
  "logo_uri": "https://example.com/logo_small.jpg",
  "policy_uri": "https://example.com/policy.html",
  "tos_uri": "https://example.com/tos.html"
  "scopes": ["openid", "eduperson"],
  "response_types": ["code"],
  "redirect_uris": ["https://cs.example.com/rp1"],
}
</pre>
<a href="#section-4.6-9" class="pilcrow">¶</a>
</div>
</section>
</section>
<section id="section-5">
      <h2 id="name-the-federation-api-2">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-the-federation-api-2" class="section-name selfRef">The Federation API</a>
      </h2>
<p id="section-5-1">
 All entities that are expected
        to publish entity statements about themselves or other entities, MUST
        expose a Federation API endpoint.
      <a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">
 The federation API endpoint of an entity is resolved from the entity
        identifier. The Federation API endpoint is found using the
 <span><a href="#RFC5785" class="xref">Well-Known URIs</a> [<a href="#RFC5785" class="xref">RFC5785</a>]</span> specification, with the suffix
        <code>openid-federation</code>. The scheme, host and port
        is taken directly from the entity identifier combined with the following
        path: <code>/.well-known/openid-federation</code>.
      <a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">
 If the entity identifier contains a path, it is concatenated after
 <code>/.well-known/openid-federation</code> in the same manner
 that path components are concatenated to the well-known identifier in
 the OAuth 2.0 Authorization Server Metadata <span>[<a href="#RFC8414" class="xref">RFC8414</a>]</span> specification.
 Of course, in real multi-tenant deployments, in which the entity ID might be of the form
 <code>https://multi-teanant-service.example.com/my-tenant-identifier</code>
 the tenant is very likely to not have control over the path
 <code>https://multi-teanant-service.example.com/.well-known/openid-federation/my-tenant-identifier</code>
 whereas it is very likely to have control over the path 
 <code>https://multi-teanant-service.example.com/my-tenant-identifier/.well-known/openid-federation</code>.
 Therefore, if using the Federation API at the URL with the tenant path after the well-known part fails,
 it is RECOMMENDED that callers retry at the URL with the tenant path before the well-known part
 (even though this violates <span>[<a href="#RFC5785" class="xref">RFC5785</a>]</span>).
      <a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">
 The Federation API is an HTTPS API that may support multiple
        operations. Fetching entity statements is one of the operations, and the
        only one
        that all Federation API endpoints are REQUIRED to support. All the
        other operations are OPTIONAL. The list of defined operations may be
        extended in a future.
      <a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">
 While all operations in the specification make use of a GET request,
        other operations may choose to use other HTTP methods. If the
 <code>operation</code>
 parameter is left out, it is treated as a
        fetch entity statements request. Unless otherwise mentioned or agreed
        upon, requests to the federation API does not need to be
        authenticated.
      <a href="#section-5-5" class="pilcrow">¶</a></p>
<section id="section-5.1">
        <h3 id="name-fetching-entity-statement-re">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-fetching-entity-statement-re" class="section-name selfRef">Fetching Entity Statement (REQUIRED)</a>
        </h3>
<p id="section-5.1-1">
   Fetching entity statement is used to collect entity statements
          one by one in order to gather trust chains.
        <a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">
   In order to fetch an entity statement, an entity needs to know the
          identifier of the entity to ask (the issuer), and the identifier of
          the entity that you want the statement to be about (the subject).
        <a href="#section-5.1-2" class="pilcrow">¶</a></p>
<div id="fetch_statement">
<section id="section-5.1.1">
          <h4 id="name-fetch-entity-statements-requ">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-fetch-entity-statements-requ" class="section-name selfRef">Fetch Entity Statements Request</a>
          </h4>
<p id="section-5.1.1-1">
     The request MUST be an HTTP request using the GET method and
            the https scheme to a resolved federation API endpoint with the
            following query string parameters:
          <a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-5.1.1-2">
            <dt id="section-5.1.1-2.1">operation</dt>
            <dd id="section-5.1.1-2.2">
 OPTIONAL. If not present, MUST be treated as
                <code>fetch</code>.
              </dd>
            <dt id="section-5.1.1-2.3">iss</dt>
            <dd id="section-5.1.1-2.4">
 REQUIRED. The entity identifier of the issuer
                from which you want an entity statement issued. Because of the
                normalization of the URL, multiple issuers may resolve to a
                shared federation API. This parameter makes it explicit exactly
                which issuer we want entity statements from.
              </dd>
            <dt id="section-5.1.1-2.5">sub</dt>
            <dd id="section-5.1.1-2.6">
 OPTIONAL. The entity identifier of the subject
                for which you would like an entity statement issued. If this
                parameter is left out, it is considered to be the same as the
                issuer and would indicate a request for a self-issued
                statement.
              </dd>
            <dt id="section-5.1.1-2.7">aud</dt>
            <dd id="section-5.1.1-2.8">
 OPTIONAL. The entity identifier of the
                requester. The issuing entity may choose to include this
                parameter to form the entity statement specifically for this
                target, in which the <code>aud</code> claim also
                SHOULD be present in the entity statement self.
              </dd>
          </dl>
<p id="section-5.1.1-3">
       The following is a non-normative example of an API
              request for an entity statement:
          <a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.1.1-4">
<pre>
GET /.well-known/openid-federation?
iss=https%3A%2F%2Fopenid.sunet.se%2Ffederation HTTP/1.1
Host: openid.sunet.se
</pre>
<a href="#section-5.1.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<section id="section-5.1.2">
          <h4 id="name-fetch-entity-statements-resp">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-fetch-entity-statements-resp" class="section-name selfRef">Fetch Entity Statements Response</a>
          </h4>
<p id="section-5.1.2-1">
     A positive response is a signed entity statement where
            the content type MUST be set to <code>application/jose</code>.
            If it is negative response it will be a JSON object and the
            content type MUST be set to
            <code>application/json</code>.
            See more about error responses in <a href="#error_response" class="xref">Section 5.4</a>.
          <a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-5.1.2-2">
       The following is a non-normative example of a response:
          <a href="#section-5.1.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.1.2-3">
<pre>
200 OK
Last-Modified: Mon, 17 Dec 2018 11:15:56 GMT
Content-Type: application/jose

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJodHRwczovL3Nlc...
</pre>
<a href="#section-5.1.2-3" class="pilcrow">¶</a>
</div>
<p id="section-5.1.2-4">(the signed JWT is truncated)<a href="#section-5.1.2-4" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-5.2">
        <h3 id="name-trust-negotiation-optional-2">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-trust-negotiation-optional-2" class="section-name selfRef">Trust Negotiation (OPTIONAL)</a>
        </h3>
<p id="section-5.2-1">
   An entity may use the trust negotiation operation in order to fetch
          resolved metadata about itself as seen/trusted by a remote peer.
          The result may, for instance, tell an RP what operations, scopes and
          claims an OP would allow the RP to use if a specific trust anchor
          was used.
        <a href="#section-5.2-1" class="pilcrow">¶</a></p>
<section id="section-5.2.1">
          <h4 id="name-trust-negotiation-request-2">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-trust-negotiation-request-2" class="section-name selfRef">Trust Negotiation Request</a>
          </h4>
<p id="section-5.2.1-1">
     The request MUST be an HTTP request using the GET method and
            the https scheme to a resolved federation API endpoint with the
            following query string parameters:
          <a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-5.2.1-2">
            <dt id="section-5.2.1-2.1">operation</dt>
            <dd id="section-5.2.1-2.2">
 REQUIRED. MUST be set to <code>resolve_metadata</code>.
              </dd>
            <dt id="section-5.2.1-2.3">respondent</dt>
            <dd id="section-5.2.1-2.4">
 REQUIRED. The entity identifier of the
                entity whose metadata are requested. Because of the
                normalization of the URL, multiple entity identifiers may
                resolve to a shared federation API. This parameter makes it
                explicit exactly which entity is expected.
              </dd>
            <dt id="section-5.2.1-2.5">peer</dt>
            <dd id="section-5.2.1-2.6">
 REQUIRED. The entity identifier of the entity
                the information is requested for. This must be a leaf entity.
              </dd>
            <dt id="section-5.2.1-2.7">type</dt>
            <dd id="section-5.2.1-2.8">
 REQUIRED. The metadata type to resolve.
                In this document, we use the metadata types listed in
                <a href="#metadata" class="xref">Section 3</a>.
              </dd>
            <dt id="section-5.2.1-2.9">anchor</dt>
            <dd id="section-5.2.1-2.10">
 REQUIRED. The trust anchor the remote peer
                MUST use when resolving the metadata.
              </dd>
          </dl>
<p id="section-5.2.1-3">
       The following is a non-normative example of an API
       request for trust negotiation:
          <a href="#section-5.2.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.2.1-4">
<pre>
GET /.well-known/openid-federation?
op=resolve_metadata&amp;
respondent=https%3A%2F%2Fopenid.sunet.se%2Ffederation&amp;
type=openid_provider&amp;
anchor=https%3A%2F%2Fswamid.se&amp;
peer=https%3A%2F%2Fidp.umu.se%2Fopenid HTTP/1.1
Host: openid.sunet.se
</pre>
<a href="#section-5.2.1-4" class="pilcrow">¶</a>
</div>
</section>
<section id="section-5.2.2">
          <h4 id="name-trust-negotiation-response-2">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-trust-negotiation-response-2" class="section-name selfRef">Trust Negotiation Response</a>
          </h4>
<p id="section-5.2.2-1">
     The response is a metadata statement that is the result of
            applying the metadata polices in the trust chain on the entity's
            metadata.
          <a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2.2-2">
       The following is a non-normative example of a response:
          <a href="#section-5.2.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.2.2-3">
<pre>
200 OK
Last-Modified: Wed, 22 Jul 2018 19:15:56 GMT
Content-Type: application/json

{
  "organization": "University of Ume?",
  "contacts": ["legal@umu.se", "technical@umu.se"],
  "logo_uri":
    "https://www.umu.se/SRWStatic/img/umu-logo-left-neg-SE.svg",
  "policy_uri":
    "https://www.umu.se/en/about-the-website/legal-information/",
  "authorization_endpoint":
    "https://idp.umu.se/openid/authorization",
  "token_endpoint": "https://idp.umu.se/openid/token",
  "response_types_supported": ["code", "code id_token", "token"],
  "grant_types_supported": [
    "authorization_code",
    "implicit",
    "urn:ietf:params:oauth:grant-type:jwt-bearer"
  ],
  "subject_types_supported": ["pairwise"],
  "id_token_signing_alg_values_supported": ["RS256"]
}
</pre>
<a href="#section-5.2.2-3" class="pilcrow">¶</a>
</div>
</section>
</section>
<section id="section-5.3">
        <h3 id="name-entity-listings-optional-2">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-entity-listings-optional-2" class="section-name selfRef">Entity Listings (OPTIONAL)</a>
        </h3>
<p id="section-5.3-1">
   An entity may query another entity for a list of all the
          entities immediately subordinate to that entity
   that that entity is prepared to issue statements about.
   (In some cases, this may be a very large list.)
        <a href="#section-5.3-1" class="pilcrow">¶</a></p>
<section id="section-5.3.1">
          <h4 id="name-entity-listings-request-2">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-entity-listings-request-2" class="section-name selfRef">Entity Listings Request</a>
          </h4>
<p id="section-5.3.1-1">
     The request MUST be an HTTP request using the GET method and
            the https scheme to a resolved federation API endpoint with the
            following query string parameters:
          <a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-5.3.1-2">
            <dt id="section-5.3.1-2.1">operation</dt>
            <dd id="section-5.3.1-2.2">
 REQUIRED. MUST be set to
                <code>listing</code>.
              </dd>
            <dt id="section-5.3.1-2.3">iss</dt>
            <dd id="section-5.3.1-2.4">
 REQUIRED. The entity identifier of the entity
                from which an entity listing is requested. Because of the
                normalization of the URL, multiple entity identifiers may
                resolve to a shared federation API. This parameter makes it
                explicit exactly which entity is expected.
              </dd>
            <dt id="section-5.3.1-2.5">is_leaf</dt>
            <dd id="section-5.3.1-2.6">
 OPTIONAL. If left out, result should
                include both leaf entities and intermediate nodes. If set to
                <code>true</code>,
                the response should contain only leaf entities. If set to
                <code>false</code>, the
                response should contain only intermediate nodes.
              </dd>
          </dl>
<p id="section-5.3.1-3">
       The following is a non-normative example of an API
       request for trust negotiation:
          <a href="#section-5.3.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.3.1-4">
<pre>
GET /.well-known/openid-federation?
op=listing&amp;
iss=https%3A%2F%2Fopenid.sunet.se%2Ffederation&amp;
type=openid_relying_party HTTP/1.1
Host: openid.sunet.se
</pre>
<a href="#section-5.3.1-4" class="pilcrow">¶</a>
</div>
</section>
<section id="section-5.3.2">
          <h4 id="name-entity-listing-response-2">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-entity-listing-response-2" class="section-name selfRef">Entity Listing Response</a>
          </h4>
<p id="section-5.3.2-1">
     The response MUST contain an JSON list with the known entity
            identifiers.
          <a href="#section-5.3.2-1" class="pilcrow">¶</a></p>
<p id="section-5.3.2-2">
       The following is a non-normative example of a response:
          <a href="#section-5.3.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.3.2-3">
<pre>
200 OK
Last-Modified: Wed, 22 Jul 2018 19:15:56 GMT
Content-Type: application/json

[
  "https://ntnu.andreas.labs.uninett.no/",
  "https://blackboard.ntnu.no/openid/callback",
  "https://serviceprovider.andreas.labs.uninett.no/application17"
]
</pre>
<a href="#section-5.3.2-3" class="pilcrow">¶</a>
</div>
</section>
</section>
<div id="error_response">
<section id="section-5.4">
        <h3 id="name-generic-error-response-2">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-generic-error-response-2" class="section-name selfRef">Generic Error Response</a>
        </h3>
<p id="section-5.4-1">
   If the request was malformed, or some error occurred during
          processing of the request, the following standardized error format
          should be used regardless of the operation specified.
        <a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">
   The HTTP response code MUST be something in 400/500-range, giving an
          indication of the type of error. The response body MUST be a JSON
          object containing the claims below and the content type MUST
          be set to <code>application/json</code>.
        <a href="#section-5.4-2" class="pilcrow">¶</a></p>
<dl class="dlNewline" id="section-5.4-3">
          <dt id="section-5.4-3.1">operation</dt>
          <dd id="section-5.4-3.2">
       REQUIRED. The operation of the request.
            </dd>
          <dt id="section-5.4-3.3">error</dt>
          <dd id="section-5.4-3.4">
       REQUIRED. The error code.
     </dd>
          <dt id="section-5.4-3.5">error_description</dt>
          <dd id="section-5.4-3.6">
       REQUIRED. A human readable short
              text describing the error.
            </dd>
        </dl>
<p id="section-5.4-4">
     The following is a non-normative example of an error response:
        <a href="#section-5.4-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.4-5">
<pre>
400 Bad request
Last-Modified: Wed, 22 Jul 2018 19:15:56 GMT
Content-Type: application/json

{
  "operation": "fetch",
  "error": "invalid_request",
  "error_description":
    "Required request parameter [iss] was missing."
}
</pre>
<a href="#section-5.4-5" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
<div id="resolving_trust">
<section id="section-6">
      <h2 id="name-resolving-trust-chain-and-me">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-resolving-trust-chain-and-me" class="section-name selfRef">Resolving Trust Chain and Metadata</a>
      </h2>
<p id="section-6-1">
 An entity (e.g., the Consumer) that wants to establish trust with a
        remote
        peer, must have the remote peer's entity identifier and a list of
        entity IDs of trusted trust anchors together with the public version
        of their signing keys. The Consumer will first have to fetch
        sufficient entity statements to establish at least one chain of trust
        from the remote peer to one or more of the configured trust anchors.
        After that the entity MUST validate the trust chains independently,
        and -- if there are multiple valid trust chains and if the
        application demands it -- choose one.
      <a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="fetching-es">
<section id="section-6.1">
        <h3 id="name-fetching-entity-statements-t">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-fetching-entity-statements-t" class="section-name selfRef">Fetching Entity Statements to Establish a Trust Chain</a>
        </h3>
<p id="section-6.1-1">
   Depending on the circumstances, the Consumer may either be
          handed the remote peer's self-issued entity statement, or it may
          have to fetch it by itself. If it needs to fetch it, it will use the
          process described in <a href="#fetch_statement" class="xref">Section 5.1.1</a>
   with both <code>iss</code> and <code>sub</code> set to the entity ID
          of the remote peer.
        <a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">
   The next step is to iterate through the list of
          intermediates listed in
          <code>authority_hints</code>, ignoring the authority
          hints that end in an unknown trust anchor, requesting an entity
          statement about the remote peer from each of the intermediates.
          If the received entity statement contains an authority hint this
          process is repeated. This time with the <code>iss</code> set to the
          intermediates entity ID and the <code>sub</code> to be the <code>iss</code> of the previous
          query.
          The Consumer should never attempt to fetch
          entity statements it already has fetched during this
          process (loop prevention).
        <a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">
   Once the Consumer has found a trust anchor it wants to use it MUST
          complete the trust chain by fetching the trust anchor's self-signed
          entity statement.
        <a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">
   A successful operation will return one or more lists of
          entity statements. Each of the lists terminating in a self-signed
          entity statement issued by a trust anchor.
        <a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">
          If there is no path from the remote peer to at least one of the
          trusted trust anchors, then the list will be empty and there is no
          way of establishing trust in the remote peer's information. How the
          Consumer deals with this is out of scope for this specification.
        <a href="#section-6.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="trust_chain_validation">
<section id="section-6.2">
        <h3 id="name-validating-the-trust-chains-2">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-validating-the-trust-chains-2" class="section-name selfRef">Validating the Trust Chains</a>
        </h3>
<p id="section-6.2-1">
   As described in <a href="#trust_chain" class="xref">Section 2.2</a>,
          a trust chain consists of an ordered list of entity
          statements. So whichever way the Consumer has acquired the set of
          entity statements, it must now verify that it is a proper trust chain
          using the rules laid out in that section.
        <a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">
          To validate the chain, the following must be done:
        <a href="#section-6.2-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.2-3.1">
            <p id="section-6.2-3.1.1">
              For each entity statement ES[j] j=i,..,0:
            <a href="#section-6.2-3.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.2-3.1.2.1">
                  Verify that the statement contains all the required claims.
                <a href="#section-6.2-3.1.2.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.2-3.1.2.2">
                  Verify that <code>iat</code> has a value in the past
                <a href="#section-6.2-3.1.2.2" class="pilcrow">¶</a>
</li>
              <li id="section-6.2-3.1.2.3">
                  Verify that <code>exp</code> has a value that is in the future.
                <a href="#section-6.2-3.1.2.3" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li id="section-6.2-3.2">
              For j=0,i verify that <code>iss</code> == <code>sub</code>.
            <a href="#section-6.2-3.2" class="pilcrow">¶</a>
</li>
          <li id="section-6.2-3.3">
              For j=1,...,i-1: Verify that ES[j]['iss'] == ES[j+1]['sub']
            <a href="#section-6.2-3.3" class="pilcrow">¶</a>
</li>
          <li id="section-6.2-3.4">
              For j=0,...,i-1: Verify the signature of ES[j] using the public
              key carried in ES[j+1]['jwks'].
            <a href="#section-6.2-3.4" class="pilcrow">¶</a>
</li>
          <li id="section-6.2-3.5">
              For j == i: verify the signature with the configured public
              key of the trust anchor.
            <a href="#section-6.2-3.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.2-4">
   Verifying the signature is a much more expensive
          operation then verifying the correctness of the statement and the
          timestamps. An implementer MAY therefor chose to not verify the
          signature until all the other checks have been done.
        <a href="#section-6.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2-5">
          No information in the chain of statements should be used
          before the signature chain has been validated.
        <a href="#section-6.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-6.3">
        <h3 id="name-choosing-one-of-the-valid-tr">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-choosing-one-of-the-valid-tr" class="section-name selfRef">Choosing One of the Valid Trust Chains</a>
        </h3>
<p id="section-6.3-1">
   If multiple valid trust chains are found, the Consumer will
          need to decide on which one to use.
        <a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">
          One simple rule would be to prefer a shorter chain over a longer
          one.
        <a href="#section-6.3-2" class="pilcrow">¶</a></p>
</section>
<div id="trust_lifetime">
<section id="section-6.4">
        <h3 id="name-calculating-the-lifetime-of-">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-calculating-the-lifetime-of-" class="section-name selfRef">Calculating the Lifetime of a Trust Chain</a>
        </h3>
<p id="section-6.4-1">
          Each entity statement in a trust chain is signed and MUST have a
          expiration time (exp) set. The expiration time of the whole trust
          chain is set to the minimum value of exp within the chain.
        <a href="#section-6.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-7">
      <h2 id="name-updating-metadata-key-rollov">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-updating-metadata-key-rollov" class="section-name selfRef">Updating Metadata, Key Rollover, and Revocation</a>
      </h2>
<p id="section-7-1">
 This specification allows for a smooth process of updating metadata
        and public keys.
      <a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">
 As described above in <a href="#trust_lifetime" class="xref">Section 6.4</a>,
        each trust chain has an expiration time.
        A consumer of metadata using this specification MUST support
        refreshing a trust chain when it expires.
        How often a consumer SHOULD re-evaluate the trust chain depends on
        how quickly the consumer wants to find out that something has changed
        in the trust chain.
      <a href="#section-7-2" class="pilcrow">¶</a></p>
<section id="section-7.1">
        <h3 id="name-protocol-key-rollover-2">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-protocol-key-rollover-2" class="section-name selfRef">Protocol Key Rollover</a>
        </h3>
<p id="section-7.1-1">
   If a leaf entity publishes its public keys in the metadata part
          using <code>jwks</code>, setting an expiration time on the self-signed entity
          statement can be used to control how often the remote party is
          fetching an updated version of the public key.
        <a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">
   If a leaf entity uses <code>jwks_uri</code>, the remote party will in the normal
          OpenID Connect way fetch the keys anew from the <code>jwks_uri</code> URI when it
          discovers that the entity uses a key it has never seen before.
        <a href="#section-7.1-2" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2">
        <h3 id="name-key-rollover-for-a-trust-anc">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-key-rollover-for-a-trust-anc" class="section-name selfRef">Key Rollover for a Trust Anchor</a>
        </h3>
<p id="section-7.2-1">
   A trust anchor must publish a self-signed entity statement about
          itself. As described above in <a href="#trust_chain" class="xref">Section 2.2</a>,
   it should be at the end of the trust chain.
          The trust anchor SHOULD set a reasonable expiration
          time on that statement, such that the consumers will re-fetch the
          entity statement at reasonable intervals. If the trust root wants to
          roll over its signing keys it would have to:
        <a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ol type="1" start="1" class="normal" id="section-7.2-2">
          <li id="section-7.2-2.1">
              Add the new keys to the <code>jwks</code> representing the trust
              anchors signing keys.
            <a href="#section-7.2-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-7.2-2.2">
              Keep signing the entity statement using
              the old keys for a long enough time period to allow all
              subordinates to have gotten access to the new keys.
            <a href="#section-7.2-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-7.2-2.3">
              Switch to signing with the new keys.
            <a href="#section-7.2-2.3" class="pilcrow">¶</a>
</li>
          <li id="section-7.2-2.4">
              After a reasonable time period remove the old keys. What is
              regarded as a reasonable time is dependent on the security profile
              and risk assessment of the trust anchor.
            <a href="#section-7.2-2.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-7.2-3">
   It must be taken into consideration that clients may have
          manually configured pubic keys as part of their configuration.
        <a href="#section-7.2-3" class="pilcrow">¶</a></p>
</section>
<section id="section-7.3">
        <h3 id="name-revocation-2">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-revocation-2" class="section-name selfRef">Revocation</a>
        </h3>
<p id="section-7.3-1">
          Since the consumers are expected to check the trust chain at regular,
          reasonably frequent times, this specification does not specify a
          standard revocation process. Specific federations may make a
          different choice and will then have to add such a process.
        <a href="#section-7.3-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-8">
      <h2 id="name-openid-connect-communication">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-openid-connect-communication" class="section-name selfRef">OpenID Connect Communication</a>
      </h2>
<p id="section-8-1">
 This section describes how the trust framework in this specification
        is used to establish trust between an RP and an OP
        that has no explicit configuration or registration in advance.
      <a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">
 There are two alternative approaches to establish trust between an
        RP and an OP, which we call automatic and explicit
        registration. Members of a federation or a community
        should agree upon which one to use. While implementations should
        support both methods, deployments may choose to disable the use of one
        of them.
      <a href="#section-8-2" class="pilcrow">¶</a></p>
<div id="automatic">
<section id="section-8.1">
        <h3 id="name-automatic-registration-2">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-automatic-registration-2" class="section-name selfRef">Automatic Registration</a>
        </h3>
<p id="section-8.1-1">
     The trust between the entities is established using the
            above described extensions in the first two steps of the
            communication between an RP and an OP. How the RP found the OP in
            the first place is out of scope for this document.
        <a href="#section-8.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1-2">
<pre>
------                                       ------
|    | &lt;--- 1) Discovery ------------------&gt; |    |
| RP | ---- 2) Authentication request -----&gt; | OP |
|    |                                       |    |
------                                       ------     
</pre>
<a href="#section-8.1-2" class="pilcrow">¶</a>
</div>
<p id="section-8.1-3">
   The <code>client_id</code> of the RP
   MUST be set identically to the RP entity identifier.
        <a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4">
   Without a registration process, the RP does not have a
          client_secret. Instead the automatic registration model requires the RP
          to make use of asymmetric cryptography.
        <a href="#section-8.1-4" class="pilcrow">¶</a></p>
<p id="section-8.1-5">
   The RP MUST host a Federation API that allows the OP to fetch the
          entity statements.
        <a href="#section-8.1-5" class="pilcrow">¶</a></p>
<section id="section-8.1.1">
          <h4 id="name-the-authentication-request-2">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-the-authentication-request-2" class="section-name selfRef">The Authentication Request</a>
          </h4>
<p id="section-8.1.1-1">
     The authentication request is as specified in OpenID Connect
            Core.
          <a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1.1-2">
     The RP MUST authenticate at the authentication endpoint
            using the private_key_jwt method described in the client
            authentication section of
            <span><a href="#OpenID.Core" class="xref">OpenID Connect Core 1.0</a> [<a href="#OpenID.Core" class="xref">OpenID.Core</a>]</span>.
          <a href="#section-8.1.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1.1-3">
       An authorization request example:
          <a href="#section-8.1.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1.1-4">
<pre>
GET /authorization?
  redirect_uri=https%3A%2F%2Fexample.com%2Fauthz_cb
  &amp;scope=openid+profile+email+address+phone
  &amp;response_type=code
  &amp;nonce=4LX0mFMxdBjkGmtx7a8WIOnB&amp;state=JpRTpu9eGXiP4thsK ...
  &amp;state=YmX8PM9I7WbNoMnnieKKBiptVW0sP2OZ
  &amp;client_id=https%3A%2F%2Flocalhost%3A8090%2Firp
  &amp;client_assertion=eyJhbGciOiJSUzI1NiIs ... qx7xHcvPOdIhnpg
  &amp;client_assertion_type=
    urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer
  HTTP/1.1
Host: https://example.org
</pre>
<a href="#section-8.1.1-4" class="pilcrow">¶</a>
</div>
</section>
<section id="section-8.1.2">
          <h4 id="name-processing-the-authenticatio">
<a href="#section-8.1.2" class="section-number selfRef">8.1.2. </a><a href="#name-processing-the-authenticatio" class="section-name selfRef">Processing the Authentication Request</a>
          </h4>
<p id="section-8.1.2-1">
     When the OP receives an incoming authentication request,
            the OP supports OpenID Connect Federation and the incoming client_id
            is a valid URL, the OP should try to resolve and fetch trust
            chains starting with the RP's entity
            statement as described in <a href="#fetching-es" class="xref">Section 6.1</a>.
          <a href="#section-8.1.2-1" class="pilcrow">¶</a></p>
<p id="section-8.1.2-2">
     The OP should validate the possible trust chains, as described in
            <a href="#trust_chain_validation" class="xref">Section 6.2</a>,
            and resolve the RP metadata with type
            <code>openid_relying_party</code>.
          <a href="#section-8.1.2-2" class="pilcrow">¶</a></p>
<p id="section-8.1.2-3">
     The OP should consider the resolved metadata of the RP, and
            verify that it complies with the client metadata specification in
            <span><a href="#OpenID.Registration" class="xref">OpenID Connect Dynamic Client Registration 1.0</a> [<a href="#OpenID.Registration" class="xref">OpenID.Registration</a>]</span>.
          <a href="#section-8.1.2-3" class="pilcrow">¶</a></p>
<p id="section-8.1.2-4">
            Once the OP has the RP's metadata, it can verify the client authentication.
          <a href="#section-8.1.2-4" class="pilcrow">¶</a></p>
</section>
<section id="section-8.1.3">
          <h4 id="name-authentication-error-respons">
<a href="#section-8.1.3" class="section-number selfRef">8.1.3. </a><a href="#name-authentication-error-respons" class="section-name selfRef">Authentication Error Response</a>
          </h4>
<p id="section-8.1.3-1">
     If the OP fails to establish trust with the RP, it should use the
            <code>invalid_request</code>
            error code, and an
            <code>error_description</code>
            that aids the RP to understand what is wrong.
          <a href="#section-8.1.3-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="explicit">
<section id="section-8.2">
        <h3 id="name-explicit-registration-2">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-explicit-registration-2" class="section-name selfRef">Explicit Registration</a>
        </h3>
<p id="section-8.2-1">
   This method involves performing an explicit registration of a new
          client the first time a RP interacts with an OP
          using something that basically follows the steps in
          <span><a href="#OpenID.Registration" class="xref">OpenID Connect Dynamic Client Registration 1.0</a> [<a href="#OpenID.Registration" class="xref">OpenID.Registration</a>]</span>
          but where the client registration request
          is a signed entity statement.
        <a href="#section-8.2-1" class="pilcrow">¶</a></p>
<section id="section-8.2.1">
          <h4 id="name-provider-discovery-2">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-provider-discovery-2" class="section-name selfRef">Provider Discovery</a>
          </h4>
<p id="section-8.2.1-1">
     The RP will start by gathering the OPs metadata using the
            process specified in <a href="#resolving_trust" class="xref">Section 6</a> above.
          <a href="#section-8.2.1-1" class="pilcrow">¶</a></p>
</section>
<div id="Clireg">
<section id="section-8.2.2">
          <h4 id="name-client-registration-2">
<a href="#section-8.2.2" class="section-number selfRef">8.2.2. </a><a href="#name-client-registration-2" class="section-name selfRef">Client Registration</a>
          </h4>
<div id="Cliregreq">
<section id="section-8.2.2.1">
            <h5 id="name-client-registration-request-2">
<a href="#section-8.2.2.1" class="section-number selfRef">8.2.2.1. </a><a href="#name-client-registration-request-2" class="section-name selfRef">Client Registration Request</a>
            </h5>
<p id="section-8.2.2.1-1">
       The OP MUST support OpenID Dynamic Client Registration as extended by this specification.
       This is signaled by having the claim
              <code>federation_registration_endpoint</code>
              in the OP's metadata.
            <a href="#section-8.2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-8.2.2.1-2">
       Given that the OP supports explicit registration, the RP
              progresses as follows:
            <a href="#section-8.2.2.1-2" class="pilcrow">¶</a></p>
<ol type="1" start="1" class="normal" id="section-8.2.2.1-3">
              <li id="section-8.2.2.1-3.1">
   Once it has the list of acceptable trust chains for the OP
                  it MUST choose the subset it wants to progress with. The
                  subset can be as small as one trust chain, but it can also
                  contain more than one.
                <a href="#section-8.2.2.1-3.1" class="pilcrow">¶</a>
</li>
              <li id="section-8.2.2.1-3.2">
   Based on the trust anchors referenced in the subset of
                  trust chains, the RP will choose a set of <code>authority_hints</code> from
                  its own set that terminates in those trust anchors.
                <a href="#section-8.2.2.1-3.2" class="pilcrow">¶</a>
</li>
              <li id="section-8.2.2.1-3.3">
   The RP will now construct a self-signed entity statement
                  where the metadata statement chosen is influenced by the OPs
                  metadata and the <code>authority_hints</code> included are picked by the
                  process described above.
                <a href="#section-8.2.2.1-3.3" class="pilcrow">¶</a>
</li>
              <li id="section-8.2.2.1-3.4">
   The entity statement is sent to the
                  <code>federation_registration_endpoint</code>
                  defined in this document.
                <a href="#section-8.2.2.1-3.4" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="cliregresp">
<section id="section-8.2.2.2">
            <h5 id="name-client-registration-response">
<a href="#section-8.2.2.2" class="section-number selfRef">8.2.2.2. </a><a href="#name-client-registration-response" class="section-name selfRef">Client Registration Response</a>
            </h5>
<section id="section-8.2.2.2.1">
              <h6 id="name-the-op-constructing-response">
<a href="#section-8.2.2.2.1" class="section-number selfRef">8.2.2.2.1. </a><a href="#name-the-op-constructing-response" class="section-name selfRef">The OP Constructing Response</a>
              </h6>
<ol type="1" start="1" class="normal" id="section-8.2.2.2.1-1">
                <li id="section-8.2.2.2.1-1.1">
     After the OP receives the request, it collects and
                    evaluates
                    the trust chains starting with the <code>authority_hints</code> in the
                    registration request.
                    After it has verified at least one trust chain it
                    can verify that the signature on the received registration
                    request is correct.
                  <a href="#section-8.2.2.2.1-1.1" class="pilcrow">¶</a>
</li>
                <li id="section-8.2.2.2.1-1.2">
     If it finds more than one acceptable trust chain, it MUST
                    choose one trust anchor from those chains as the one it will
                    proceed with.
                  <a href="#section-8.2.2.2.1-1.2" class="pilcrow">¶</a>
</li>
                <li id="section-8.2.2.2.1-1.3">
     At this point, if there already exists a client
                    registration under the same entity ID then that registration
                    MUST be regarded as invalid. <code>Note</code> that key material from
                    the
                    previous registration MUST be kept to make key rollover
                    possible.
                  <a href="#section-8.2.2.2.1-1.3" class="pilcrow">¶</a>
</li>
                <li id="section-8.2.2.2.1-1.4">
     The OP will now construct a metadata policy that, if
                    applied to the RP's metadata statement, will result in
                    metadata that the OP finds acceptable.
                    <code>Note</code> that the client_id the OP chooses does not have to be
                    the same as the entity ID of the RP.
                    To the entity statement it will add one or more
                    <code>authority_hints</code>, from its collection, that terminate in the
                    trust anchor chosen above.
                  <a href="#section-8.2.2.2.1-1.4" class="pilcrow">¶</a>
</li>
                <li id="section-8.2.2.2.1-1.5">
     It will sign and return the registration response (a signed
                    entity statement) to the RP.
                  <a href="#section-8.2.2.2.1-1.5" class="pilcrow">¶</a>
</li>
              </ol>
</section>
<section id="section-8.2.2.2.2">
              <h6 id="name-the-rp-parsing-the-response-2">
<a href="#section-8.2.2.2.2" class="section-number selfRef">8.2.2.2.2. </a><a href="#name-the-rp-parsing-the-response-2" class="section-name selfRef">The RP Parsing the Response</a>
              </h6>
<ol type="1" start="1" class="normal" id="section-8.2.2.2.2-1">
                <li id="section-8.2.2.2.2-1.1">
     The RP verifies the correctness of the received entity
                    statement, making sure that the trust chains starting at the
                    <code>authority_hints</code> terminates in trust anchors that were
                    referenced in the entity statement it sent to the OP.
                  <a href="#section-8.2.2.2.2-1.1" class="pilcrow">¶</a>
</li>
                <li id="section-8.2.2.2.2-1.2">
     The RP MUST NOT apply metadata policies from the trust
                    chains that the OP provides because those are not valid for
                    the RPs metadata.
                    The RP MUST apply policies to the metadata using one of its
                    own trust chains that ends in the trust anchor that the OP chose.
     Once it has applied those policies it can the apply
                    the policy returned from the OP.
                    When it has applied all the metadata policies to its
                    metadata statement, it then stores
                    the result and can continue communicating with the OP
                    using the agreed-upon metadata.
                  <a href="#section-8.2.2.2.2-1.2" class="pilcrow">¶</a>
</li>
                <li id="section-8.2.2.2.2-1.3">
     At this point the RP also knows which trust chain it should
                    use when evaluating the OPs metadata. It can therefore
                    apply the metadata policies on the OPs metadata using the
                    relevant trust chain and store the result as the OPs
                    metadata.
                  <a href="#section-8.2.2.2.2-1.3" class="pilcrow">¶</a>
</li>
                <li id="section-8.2.2.2.2-1.4">
     If the RP was not OK, for some reason, with the received
                    entity statement then it has the choice to restart the
                    registration process or to give up.
                  <a href="#section-8.2.2.2.2-1.4" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</section>
</div>
</section>
</div>
<section id="section-8.2.3">
          <h4 id="name-after-client-registration-2">
<a href="#section-8.2.3" class="section-number selfRef">8.2.3. </a><a href="#name-after-client-registration-2" class="section-name selfRef">After client registration</a>
          </h4>
<p id="section-8.2.3-1">
     A client registration using this specification is not expected to
            be valid forever. The entity statements exchanged all have
            expiration times, which means that the registration will eventually
            time out. An OP can also for administrative reasons decide that a
            client registration is not valid anymore. An example of this could
            be that the OP leaves the federation in use.
          <a href="#section-8.2.3-1" class="pilcrow">¶</a></p>
<section id="section-8.2.3.1">
            <h5 id="name-what-the-rp-must-do-2">
<a href="#section-8.2.3.1" class="section-number selfRef">8.2.3.1. </a><a href="#name-what-the-rp-must-do-2" class="section-name selfRef">What the RP MUST Do</a>
            </h5>
<p id="section-8.2.3.1-1">
       At regular intervals the RP MUST:
            <a href="#section-8.2.3.1-1" class="pilcrow">¶</a></p>
<ol type="1" start="1" class="normal" id="section-8.2.3.1-2">
              <li id="section-8.2.3.1-2.1">
   Starting with the OPs entity statement, resolve and verify
                  the trust chains it chooses to use when constructing the
                  registration request. If those trust chains do not exist
                  anymore or do not verify, then the registration should be
                  regarded as invalid and a new registration process should be
                  started.
                <a href="#section-8.2.3.1-2.1" class="pilcrow">¶</a>
</li>
              <li id="section-8.2.3.1-2.2">
   If the OPs entity statement was properly formed the RP must
                  now verify that the entity statement it received about itself
                  from the OP is still valid.
                  Again, if that is not the case the registration
                  should be regarded as invalid and a new registration process
                  should be started.
                <a href="#section-8.2.3.1-2.2" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-8.2.3.1-3">
              What is regarded as reasonable intervals will depend on
              federation policies and risk assessment by the maintainer of
              the RP.
            <a href="#section-8.2.3.1-3" class="pilcrow">¶</a></p>
</section>
<section id="section-8.2.3.2">
            <h5 id="name-what-the-op-must-do-2">
<a href="#section-8.2.3.2" class="section-number selfRef">8.2.3.2. </a><a href="#name-what-the-op-must-do-2" class="section-name selfRef">What the OP MUST Do</a>
            </h5>
<p id="section-8.2.3.2-1">
       At regular intervals the OP MUST:
            <a href="#section-8.2.3.2-1" class="pilcrow">¶</a></p>
<ol type="1" start="1" class="normal" id="section-8.2.3.2-2">
              <li id="section-8.2.3.2-2.1">
                  If the signature on the registration request has expired it
                  MUST mark the registration as invalid and demand that the
                  RP MUST re-register. Else
                <a href="#section-8.2.3.2-2.1" class="pilcrow">¶</a>
</li>
              <li id="section-8.2.3.2-2.2">
                  starting with the RPs client registration request, the OP MUST
                  verify that there still is a valid trust chain terminating in
                  the trust anchor the OP chose during the registration process.
                <a href="#section-8.2.3.2-2.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</section>
<section id="section-8.2.4">
          <h4 id="name-expiration-times-2">
<a href="#section-8.2.4" class="section-number selfRef">8.2.4. </a><a href="#name-expiration-times-2" class="section-name selfRef">Expiration Times</a>
          </h4>
<p id="section-8.2.4-1">
     An OP MUST NOT assign an expiration time
            to a RP's registration that is later then the trust
            chains expiration time.
          <a href="#section-8.2.4-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
</section>
<div id="IANA">
<section id="section-9">
      <h2 id="name-iana-considerations-2">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations-2" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">
 TBD Register federation_types_supported for OP metadata with initial values automatic, explicit.
      <a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">
 TBD Register federation_type for RP registration metadata.
      <a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">
 TBD Register federation_registration_endpoint for the OP metadata.
      <a href="#section-9-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Security">
<section id="section-10">
      <h2 id="name-security-considerations-2">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-security-considerations-2" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-10-1">
 TBD
      <a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-11">
      <h2 id="name-references-2">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references-2" class="section-name selfRef">References</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-normative-references-2">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references-2" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="OpenID.Core">[OpenID.Core]</dt>
        <dd>
<span class="refAuthor">Sakimura, N.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, Jones, M.B.</span><span class="refAuthor">, de Medeiros, B.</span><span class="refAuthor">, and C. Mortimore</span>, <span class="refTitle">"OpenID Connect Discovery 1.0"</span>, <time datetime="2015-08-03">3 August 2015</time>
          <span>, &lt;<a href="http://openid.net/specs/openid-connect-core-1_0.html">http://openid.net/specs/openid-connect-core-1_0.html</a>&gt;</span>. </dd>
<dt id="OpenID.Discovery">[OpenID.Discovery]</dt>
        <dd>
<span class="refAuthor">Sakimura, N.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, Jones, M.B.</span><span class="refAuthor">, and E. Jay</span>, <span class="refTitle">"OpenID Connect Discovery 1.0"</span>, <time datetime="2015-08-03">3 August 2015</time>
          <span>, &lt;<a href="http://openid.net/specs/openid-connect-discovery-1_0.html">http://openid.net/specs/openid-connect-discovery-1_0.html</a>&gt;</span>. </dd>
<dt id="OpenID.Registration">[OpenID.Registration]</dt>
        <dd>
<span class="refAuthor">Sakimura, N.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, and M.B. Jones</span>, <span class="refTitle">"OpenID Connect Dynamic Client Registration 1.0"</span>, <time datetime="2015-08-03">3 August 2015</time>
          <span>, &lt;<a href="http://openid.net/specs/openid-connect-registration-1_0.html">http://openid.net/specs/openid-connect-registration-1_0.html</a>&gt;</span>. </dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03">March 1997</time>
            <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dt id="RFC3339">[RFC3339]</dt>
        <dd>
<span class="refAuthor">Klyne, G.</span><span class="refAuthor"> and C. Newman</span>, <span class="refTitle">"Date and Time on the Internet: Timestamps"</span>, <span class="seriesInfo">RFC 3339</span>, <span class="seriesInfo">DOI 10.17487/RFC3339</span>, <time datetime="2002-07">July 2002</time>
            <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc3339">https://www.rfc-editor.org/info/rfc3339</a>&gt;</span>. </dd>
<dt id="RFC5785">[RFC5785]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span><span class="refAuthor"> and E. Hammer-Lahav</span>, <span class="refTitle">"Defining Well-Known Uniform Resource Identifiers (URIs)"</span>, <span class="seriesInfo">RFC 5785</span>, <span class="seriesInfo">DOI 10.17487/RFC5785</span>, <time datetime="2010-04">April 2010</time>
            <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc5785">https://www.rfc-editor.org/info/rfc5785</a>&gt;</span>. </dd>
<dt id="RFC6749">[RFC6749]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10">October 2012</time>
            <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc6749">https://www.rfc-editor.org/info/rfc6749</a>&gt;</span>. </dd>
<dt id="RFC7515">[RFC7515]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, and N. Sakimura</span>, <span class="refTitle">"JSON Web Signature (JWS)"</span>, <span class="seriesInfo">RFC 7515</span>, <span class="seriesInfo">DOI 10.17487/RFC7515</span>, <time datetime="2015-05">May 2015</time>
            <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc7515">https://www.rfc-editor.org/info/rfc7515</a>&gt;</span>. </dd>
<dt id="RFC7517">[RFC7517]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refTitle">"JSON Web Key (JWK)"</span>, <span class="seriesInfo">RFC 7517</span>, <span class="seriesInfo">DOI 10.17487/RFC7517</span>, <time datetime="2015-05">May 2015</time>
            <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc7517">https://www.rfc-editor.org/info/rfc7517</a>&gt;</span>. </dd>
<dt id="RFC7519">[RFC7519]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, and N. Sakimura</span>, <span class="refTitle">"JSON Web Token (JWT)"</span>, <span class="seriesInfo">RFC 7519</span>, <span class="seriesInfo">DOI 10.17487/RFC7519</span>, <time datetime="2015-05">May 2015</time>
            <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc7519">https://www.rfc-editor.org/info/rfc7519</a>&gt;</span>. </dd>
<dt id="RFC7591">[RFC7591]</dt>
        <dd>
<span class="refAuthor">Richer, J., Ed.</span><span class="refAuthor">, Jones, M.</span><span class="refAuthor">, Bradley, J.</span><span class="refAuthor">, Machulak, M.</span><span class="refAuthor">, and P. Hunt</span>, <span class="refTitle">"OAuth 2.0 Dynamic Client Registration Protocol"</span>, <span class="seriesInfo">RFC 7591</span>, <span class="seriesInfo">DOI 10.17487/RFC7591</span>, <time datetime="2015-07">July 2015</time>
            <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc7591">https://www.rfc-editor.org/info/rfc7591</a>&gt;</span>. </dd>
<dt id="RFC8414">[RFC8414]</dt>
      <dd>
<span class="refAuthor">Jones, M.</span><span class="refAuthor">, Sakimura, N.</span><span class="refAuthor">, and J. Bradley</span>, <span class="refTitle">"OAuth 2.0 Authorization Server Metadata"</span>, <span class="seriesInfo">RFC 8414</span>, <span class="seriesInfo">DOI 10.17487/RFC8414</span>, <time datetime="2018-06">June 2018</time>
            <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc8414">https://www.rfc-editor.org/info/rfc8414</a>&gt;</span>. </dd>
</dl>
</section>
<section id="section-11.2">
        <h3 id="name-informative-references-2">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references-2" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC8446">[RFC8446]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08">August 2018</time>
            <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
</dl>
</section>
</section>
<section id="section-appendix.a">
      <h2 id="name-illustrative-example-of-openi">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-illustrative-example-of-openi" class="section-name selfRef">Illustrative Example of OpenID Connect Flow Using Automatic Client Registration</a>
      </h2>
<p id="section-appendix.a-1">
 A service Foodle would like to offer its services to all OPs in
        eduGAIN. Foodle is managed and registered by the university
        NTNU. NTNU is part of the Norwegian Feide federation. Foodle is also
        directly trusted in the Swedish SWAMID federation. Both Feide and SWAMID
        are part of the international eduGAIN federation.
      <a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<section id="section-a.1">
        <h2 id="name-initial-setup-of-foodle-2">
<a href="#section-a.1" class="section-number selfRef">A.1. </a><a href="#name-initial-setup-of-foodle-2" class="section-name selfRef">Initial Setup of Foodle</a>
        </h2>
<p id="section-a.1-1">
   The Foodle service chooses to use the entity identifier
   <code>https://foodl.org/</code>.
   And upon deployment, Foodle
          is setup with an RSA key pair, with the following public key:
        <a href="#section-a.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.1-2">
<pre>
{
  "kid": "key1",
  "use": "sig",
  "kty": "RSA",
  "alg": "RS256",
  "n": "pnXBOusEANuug6ewezb9J_XbxbSGEISyA75wBGkerPNg6WTXmmxJ-DV1U4sCu
RqhSdo3Uncmw6-01bZKCtAyRHT_TOZN2TMfNPRsfLkOstVofyfxg5oIWViLX9IDG_iZVd
q6_T6yOuufOIvqpaeBMwSKuDXHNa_DU0aUu_3kOAc5_2hD4Dq-XXtum-oix2EPkNSbFfP
qFIp5n4gS1XrzGzuNQiDw82k-H6mWN0wlVWfqLxJA9DZikAX7x9feipn36wxDH-XUlzDD
Ui3nfnC8GSkT-CYII3oZPsIgMV527iQGVsehIV9KqTF2FnaP83cqV9YgvMfhs1wrx4L3Z
-3B8Q",
  "e": "AQAB",
  "key_ops": ["verify"],
  "ext": true
}
</pre>
<a href="#section-a.1-2" class="pilcrow">¶</a>
</div>
<p id="section-a.1-3">
   Foodle offers a WebFinger interface and a metadata API according to
          this specification, with the ability to issue entity statements about
          itself.
        <a href="#section-a.1-3" class="pilcrow">¶</a></p>
</section>
<section id="section-a.2">
        <h2 id="name-federation-setup-2">
<a href="#section-a.2" class="section-number selfRef">A.2. </a><a href="#name-federation-setup-2" class="section-name selfRef">Federation Setup</a>
        </h2>
<p id="section-a.2-1">
   How trust is established and how entities become part of a federation
          is out of scope of this specification. It could involve some kind
          of non-technical contract, agreement or term of use that is
          established, followed by a federation or trust issuer that registers
          an entity identifier, public key and a set of metadata that restricts
          the delegated trust that is represented in the entity statement about
          the joining party.
        <a href="#section-a.2-1" class="pilcrow">¶</a></p>
<p id="section-a.2-2">
   The following example, assumes the following trust relations are
          established, and the following entities are able to issue entity
          statements:
        <a href="#section-a.2-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-a.2-3.1">
       Foodle issues an entity statement about itself
     <a href="#section-a.2-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-a.2-3.2">
       NTNU issues an entity statement about Foodle
     <a href="#section-a.2-3.2" class="pilcrow">¶</a>
</li>
          <li id="section-a.2-3.3">
       SWAMID issues an entity statement about Foodle
     <a href="#section-a.2-3.3" class="pilcrow">¶</a>
</li>
          <li id="section-a.2-3.4">
       Feide issues an entity statement about NTNU
     <a href="#section-a.2-3.4" class="pilcrow">¶</a>
</li>
          <li id="section-a.2-3.5">
       eduGAIN issues an entity statement about Feide
     <a href="#section-a.2-3.5" class="pilcrow">¶</a>
</li>
          <li id="section-a.2-3.6">
       eduGAIN issues an entity statement about SWAMID
     <a href="#section-a.2-3.6" class="pilcrow">¶</a>
</li>
          <li id="section-a.2-3.7">
          eudGAIN issues an entity statement about itself
        <a href="#section-a.2-3.7" class="pilcrow">¶</a>
</li>
          <li id="section-a.2-3.8">
       SWAMID issues an entity statement about the university of Umea
              - an OP for employees and students at the university of Umea
            <a href="#section-a.2-3.8" class="pilcrow">¶</a>
</li>
          <li id="section-a.2-3.9">
                SWAMID issues an entity statement about itself
            <a href="#section-a.2-3.9" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-a.2-4">
          Foodle has a local trust root configuration that contains public
          signing keys for known federations:
        <a href="#section-a.2-4" class="pilcrow">¶</a></p>
<p id="section-a.2-5">
     "https://www.sunet.se/swamid"
        <a href="#section-a.2-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.2-6">
<pre>
{
  "keys": [
    {
      "kty": "RSA",
      "alg": "RS256",
      "n": "v6xydqciFKGfvQaqYGmk9A7etbfvNY...",
      "e": "AQAB",
      "key_ops": ["verify"],
      "ext": true,
      "kid": "9Gx7-Kkz_18DhpQ...",
      "use": "sig"
    }
  ]
}
</pre>
<a href="#section-a.2-6" class="pilcrow">¶</a>
</div>
</section>
<section id="section-a.3">
        <h2 id="name-user-chooses-to-login-at-foo">
<a href="#section-a.3" class="section-number selfRef">A.3. </a><a href="#name-user-chooses-to-login-at-foo" class="section-name selfRef">User Chooses to Login at Foodle</a>
        </h2>
<p id="section-a.3-1">
   Let us assume a student from Umeae would like to login at
          Foodle. Some sort of discovery process involves the end user choosing
          an OP. OpenID Discovery using the e-mail address is one
          option. Foodle presenting a list of available OPs for the user
          to choose from is another.
        <a href="#section-a.3-1" class="pilcrow">¶</a></p>
<p id="section-a.3-2">
   After the discovery process, Foodle knows that the user would like
          to login using the OP with entity identifier
   <code>https://www.umu.se/openid</code>.
        <a href="#section-a.3-2" class="pilcrow">¶</a></p>
</section>
<section id="section-a.4">
        <h2 id="name-foodle-discovers-the-op-2">
<a href="#section-a.4" class="section-number selfRef">A.4. </a><a href="#name-foodle-discovers-the-op-2" class="section-name selfRef">Foodle Discovers the OP</a>
        </h2>
<p id="section-a.4-1">
   Foodle
          performs a request to fetch the self-issued entity statement using the
          Federation API of the OP.
        <a href="#section-a.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.4-2">
<pre>
GET /.well-known/openid-federation/openid?
iss=https%3A%2F%2Fumu.se%2Fopenid HTTP/1.1
Host: www.umu.se
</pre>
<a href="#section-a.4-2" class="pilcrow">¶</a>
</div>
<p id="section-a.4-3">
   Yielding this response:
        <a href="#section-a.4-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.4-4">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InVtdSJ9.eyJpYXQi..."
]&gt;&lt;/artwork&gt;
        &lt;/figure&gt;

        &lt;t&gt;
          The API endpoint returns a signed entity statement. In
          this case we looked for a self-issued statement from the Ume&amp;aring;
          university. We then decode and inspect the content:
        &lt;/t&gt;
        &lt;figure&gt;
          &lt;artwork&gt;&lt;![CDATA[
{
  "iat": 1539174048,
  "exp": 1539177648,
  "iss": "https://umu.se/openid",
  "sub": "https://umu.se/openid",
  "metadata": {
    "openid_provider": {
      "federation_types_supported": ["automatic", "explicit"],
      "authorization_endpoint":
        "https://idp.umu.se/openid/authorization",
      "token_endpoint": "https://idp.umu.se/openid/token",
      "response_types_supported": ["code", "code id_token", "token"],
      "grant_types_supported": [
        "authorization_code",
        "implicit",
        "urn:ietf:params:oauth:grant-type:jwt-bearer"
      ],
      "subject_types_supported": ["pairwise", "public"],
      "id_token_signing_alg_values_supported": ["RS256"],
      "logo_uri":
        "https://www.umu.se/img/umu-logo-left-neg-SE.svg",
      "policy_uri":
        "https://www.umu.se/en/website/legal-information/"
    }
  },
  "authority_hints": {
    "https://www.sunet.se/swamid": ["https://edugain.org/oidc"],
    "https://kalmar2.org/openid": []
  },
  "jwks": {
    "keys": [
      {
        "kty": "RSA",
        "alg": "RS256",
        "n": "z1V1kyi6qwmXfKsfhVqKUMmQH3AixN...",
        "e": "AQAB",
        "key_ops": ["verify"],
        "ext": true,
        "kid": "8S9-dy4GN8_-z...",
        "use": "sig"
      }
    ]
  }
}
</pre>
<a href="#section-a.4-4" class="pilcrow">¶</a>
</div>
</section>
<section id="section-a.5">
        <h2 id="name-resolving-the-ops-trust-chain">
<a href="#section-a.5" class="section-number selfRef">A.5. </a><a href="#name-resolving-the-ops-trust-chain" class="section-name selfRef">Resolving the OP's Trust Chain</a>
        </h2>
<p id="section-a.5-1">
   In order to establish trust with this OP, the Foodle RP
          would need to fetch sufficient entity statements to represent
          a complete chain from the self-issued statement to the locally
          configured trust root, which contains SWAMID.
        <a href="#section-a.5-1" class="pilcrow">¶</a></p>
<p id="section-a.5-2">
   The information found in the <code>authority_hints</code> is critical in order
          to dynamically discover the trust chain. If such hints are not
          present, the RP may fall back to fixed configured trust roots
          to ask for entity statements.
        <a href="#section-a.5-2" class="pilcrow">¶</a></p>
<p id="section-a.5-3">
   In this example, Foodle now fetches an entity statement from SWAMID
          using the Federation API endpoint of SWAMID, discovered in the
          <code>authority_hints</code> claim.
        <a href="#section-a.5-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.5-4">
<pre>
GET /.well-known/openid-federation?
iss=https%3A%2F%2Fwww.sunet.se%2Fswamid&amp;
sub=https%3A%2F%2Fumu.se%2Fopenid HTTP/1.1
Host: www.sunet.se
</pre>
<a href="#section-a.5-4" class="pilcrow">¶</a>
</div>
<p id="section-a.5-5">
   Yielding this response:
        <a href="#section-a.5-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.5-6">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImZlaWRlIn0.eyJpY..."
</pre>
<a href="#section-a.5-6" class="pilcrow">¶</a>
</div>
<p id="section-a.5-7">
   The decoded version of the entity statement is:
        <a href="#section-a.5-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.5-8">
<pre>
{
  "iat": 1539174048,
  "exp": 1539177648,
  "metadata_policy": {
    "openid_provider": {
      "subject_types_supported": {
        "value": ["pairwise"]},
      "id_token_signing_alg_values_supported":{
          "subset_of": ["RS256", "RS512"],
          "default": ["RS256", "RS512"]
        }
      "organization": {
        "value": "University of Ume&amp;aring;"},
      "contacts": {
        "add": ["legal@umu.se", "technical@umu.se"]}
    },
    "openid_relying_party": {}
  },
  "iss": "https://www.sunet.se/swamid",
  "sub": "https://umu.se/openid",
  "jwks": {
    "keys": [
      {
        "kty": "RSA",
        "alg": "RS256",
        "n": "v6xydqciFKGfvQaqYGmk9A7etbfvNY...",
        "e": "AQAB",
        "key_ops": ["verify"],
        "ext": true,
        "kid": "9Gx7-Kkz_18DhpQ...",
        "use": "sig"
      }
    ]
  },
  "authority_hints": {
    "https://www.sunet.se/swamid": ["https://www.sunet.se/swamid"]
  }
}
</pre>
<a href="#section-a.5-8" class="pilcrow">¶</a>
</div>
<p id="section-a.5-9">
   Notice that the entity statement about University of Umeae
          also contains an entry for openid_relying_party metadata. This metadata policy indicates that
          SWAMID expresses this university to be trusted to issue its own OpenID Relying Parties
   and OpenID Providers without the need for registering these directly in SWAMID.
        <a href="#section-a.5-9" class="pilcrow">¶</a></p>
<p id="section-a.5-10">
            The last step then is that Foodle now fetches an entity statement
              from SWAMID about SWAMID using the Federation API endpoint of
              SWAMID, discovered in the <code>authority_hints</code> claim.
        <a href="#section-a.5-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.5-11">
<pre>
GET /.well-known/openid-federation?
iss=https%3A%2F%2Fwww.sunet.se%2Fswamid&amp;
sub=https%3A%2F%2Fwww.sunet.se%2Fswamid HTTP/1.1
Host: www.sunet.se
</pre>
<a href="#section-a.5-11" class="pilcrow">¶</a>
</div>
<p id="section-a.5-12">
   Yielding this response:
        <a href="#section-a.5-12" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.5-13">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImZlaWRlIn0.eyJpY..."
</pre>
<a href="#section-a.5-13" class="pilcrow">¶</a>
</div>
<p id="section-a.5-14">
   The decoded version of the entity statement is:
        <a href="#section-a.5-14" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.5-15">
<pre>
{
  "iat": 1539174050,
  "exp": 1539177650,
  "metadata": {
    "federation_entity": {
        "name": "SWAMID",
        "homepage_uri": "https://swamid.se/index.html"
    },
  },
  "iss": "https://www.sunet.se/swamid",
  "sub": "https://www.sunet.se/swamid",
  "jwks": {
    "keys": [
      {
        "e": "AQAB",
        "kid": "SnJJSVFodkFXOX...",
        "kty": "RSA",
        "n": "5uGR_-KKce9ycV6...",
        "use": "sig"
      }
    ]
  }
}
</pre>
<a href="#section-a.5-15" class="pilcrow">¶</a>
</div>
<p id="section-a.5-16">
   These three entity statements are sufficient to establish a path from
          the locally configured trust anchor which trust SWAMID, to the
          self-issued statement from the University of Umeae.
          Here are the steps performed to validate the trust chain:
        <a href="#section-a.5-16" class="pilcrow">¶</a></p>
<ul>
<li id="section-a.5-17.1">
       Find the trusted public keys for SWAMID in the local trust
              configuration.
            <a href="#section-a.5-17.1" class="pilcrow">¶</a>
</li>
          <li id="section-a.5-17.2">
       Use these keys to validate the signature of the signed entity
              statement issued by SWAMID about SWAMID.
            <a href="#section-a.5-17.2" class="pilcrow">¶</a>
</li>
          <li id="section-a.5-17.3">
                  Extract the <code>jwks</code> entry from this entity statement.
                  These are the signing keys of SWAMID. If there are keys in this
                  field that does not appear in the local trust configuration
                  add them to the ones that appear in the local trust configuration.
                  This is a necessary step to allow SWAMID, in this case, to rotate their signing keys.
              <a href="#section-a.5-17.3" class="pilcrow">¶</a>
</li>
          <li id="section-a.5-17.4">
       Use the SWAMID keys to validate the signature of the signed entity
              statement issued by SWAMID about the University of Umeae.
            <a href="#section-a.5-17.4" class="pilcrow">¶</a>
</li>
          <li id="section-a.5-17.5">
       Check that the <code>sub</code> from the trust configuration matches the <code>iss</code>
              value of the first entity statement.
            <a href="#section-a.5-17.5" class="pilcrow">¶</a>
</li>
          <li id="section-a.5-17.6">
       Extract the <code>jwks</code> entry from this entity statement. These are
              the signing keys of the University of Umeae.
            <a href="#section-a.5-17.6" class="pilcrow">¶</a>
</li>
          <li id="section-a.5-17.7">
       Validate the self-signed statement from University of
              Umeae using the keys found above.
            <a href="#section-a.5-17.7" class="pilcrow">¶</a>
</li>
          <li id="section-a.5-17.8">
       Check that the <code>sub</code> from the previous statement matches the <code>iss</code>
              of the self-issued statement.
            <a href="#section-a.5-17.8" class="pilcrow">¶</a>
</li>
          <li id="section-a.5-17.9">
       Check that the self-issued statement has the same values for
       <code>iss</code> and <code>sub</code>.
            <a href="#section-a.5-17.9" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<div id="extracting_op_metadata">
<section id="section-a.6">
        <h2 id="name-extracting-the-op-metadata-2">
<a href="#section-a.6" class="section-number selfRef">A.6. </a><a href="#name-extracting-the-op-metadata-2" class="section-name selfRef">Extracting the OP metadata</a>
        </h2>
<p id="section-a.6-1">
   The output from the trust chain validation is an ordered list of
          entity statements. In order to extract the needed metadata, we need to
          look at the metadata type relevant in the given context. In this case,
          we are establishing trust with an OP, and we take the
          <code>openid_provider</code>
          metadata object from the
          entity statement published by the OP and the policy statements from
          the other entities in the trust chain:
        <a href="#section-a.6-1" class="pilcrow">¶</a></p>
<p id="section-a.6-2">
     SWAMID's metadata policy for an openid_provider:
        <a href="#section-a.6-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.6-3">
<pre>
{}
</pre>
<a href="#section-a.6-3" class="pilcrow">¶</a>
</div>
<p id="section-a.6-4">
     UMU's metadata policy for an openid_provider:
        <a href="#section-a.6-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.6-5">
<pre>
{
  "subject_types_supported": {"value": ["pairwise"]},
  "id_token_signing_alg_values_supported":
    {
      "subset_of": ["RS256", "RS512"],
      "default": ["RS256", "RS512"]
    }
  "organization": {"value": "University of Ume&amp;aring;"},
  "contacts": {"add": ["legal@umu.se", "technical@umu.se"]}
}
</pre>
<a href="#section-a.6-5" class="pilcrow">¶</a>
</div>
<p id="section-a.6-6">
          and finally
        <a href="#section-a.6-6" class="pilcrow">¶</a></p>
<p id="section-a.6-7">
     The OP's metadata statement:
        <a href="#section-a.6-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.6-8">
<pre>
{
  "authorization_endpoint":
    "https://idp.umu.se/openid/authorization",
  "token_endpoint": "https://idp.umu.se/openid/token",
  "response_types_supported": ["code", "code id_token", "token"],
  "grant_types_supported": [
    "authorization_code",
    "implicit",
    "urn:ietf:params:oauth:grant-type:jwt-bearer"
  ],
  "subject_types_supported": ["pairwise", "public"],
  "id_token_signing_alg_values_supported": ["RS256"],
  "logo_uri":
      "https://www.umu.se/SRWStatic/img/umu-logo-left-neg-SE.svg",
  "policy_uri":
      "https://www.umu.se/en/about-the-website/legal-information/"
}
</pre>
<a href="#section-a.6-8" class="pilcrow">¶</a>
</div>
<p id="section-a.6-9">
   Applying the metadata policies to the metadata
          produces the following result:
        <a href="#section-a.6-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.6-10">
<pre>
{
  "organization": "University of Ume&amp;aring;",
  "contacts": ["legal@umu.se", "technical@umu.se"],
  "logo_uri":
    "https://www.umu.se/SRWStatic/img/umu-logo-left-neg-SE.svg",
  "policy_uri":
    "https://www.umu.se/en/about-the-website/legal-information/",
  "authorization_endpoint":
    "https://idp.umu.se/openid/authorization",
  "token_endpoint": "https://idp.umu.se/openid/token",
  "response_types_supported": ["code", "code id_token", "token"],
  "grant_types_supported": [
    "authorization_code",
    "implicit",
    "urn:ietf:params:oauth:grant-type:jwt-bearer"
  ],
  "subject_types_supported": ["pairwise"],
  "id_token_signing_alg_values_supported": ["RS256"]
}
</pre>
<a href="#section-a.6-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<section id="section-a.7">
        <h2 id="name-rp-sends-authentication-requ">
<a href="#section-a.7" class="section-number selfRef">A.7. </a><a href="#name-rp-sends-authentication-requ" class="section-name selfRef">RP Sends Authentication Request (Automatic Registration)</a>
        </h2>
<p id="section-a.7-1">
   Foodle after establishing trust with the University of
          Umeae
          and extracted metadata and a set of metadata policies, will send an
          authentication request to the OP.
   This example uses automatic registration.
        <a href="#section-a.7-1" class="pilcrow">¶</a></p>
<p id="section-a.7-2">
   Here is an example of an authentication request:
        <a href="#section-a.7-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.7-3">
<pre>
GET /authorize?
  response_type=code
  &amp;scope=openid%20profile%20email
  &amp;client_id=https%3A%2F%2Ffoodl.org%2F
  &amp;state=2ff7e589-3848-46da-a3d2-949e1235e671
  &amp;redirect_uri=https%3A%2F%2Ffoodl.org%2Fopenid%2Fcallback
  &amp;client_assertion=eyJhbGciOiJSUzI1NiIs ... qx7xHcvPOdIhnpg
  &amp;client_assertion_type=
    urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer
  HTTP/1.1
Host: idp.umu.se
</pre>
<a href="#section-a.7-3" class="pilcrow">¶</a>
</div>
<p id="section-a.7-4">
   The OP receiving this authentication request will, unless the
          RP is cached or statically configured, start to dynamically fetch and
          establish trust with the RP.
        <a href="#section-a.7-4" class="pilcrow">¶</a></p>
</section>
<section id="section-a.8">
        <h2 id="name-op-fetches-entity-statements">
<a href="#section-a.8" class="section-number selfRef">A.8. </a><a href="#name-op-fetches-entity-statements" class="section-name selfRef">OP Fetches Entity Statements</a>
        </h2>
<p id="section-a.8-1">
   The OP needs to establish a trust chain for the RP from which an
          authentication was received. The OP in this example are configured
          with public key of 2 federations:
        <a href="#section-a.8-1" class="pilcrow">¶</a></p>
<p id="section-a.8-2">
     "https://edugain.org/oidc"
        <a href="#section-a.8-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.8-3">
<pre>
 {
  "keys": [
    {
      "kty": "RSA",
      "use": "sig",
      "alg": "RS256",
      "n": "qnd5_krrHKzuJzb5_YEt4sP-YOGSbf...",
      "e": "AQAB",
      "key_ops": ["verify"],
      "ext": true,
      "kid": "SX7_-Q0heLZq6T..."
    }
  ]
}
</pre>
<a href="#section-a.8-3" class="pilcrow">¶</a>
</div>
<p id="section-a.8-4">
          and
        <a href="#section-a.8-4" class="pilcrow">¶</a></p>
<p id="section-a.8-5">
     "https://www.sunet.se/swamid"
        <a href="#section-a.8-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.8-6">
<pre>
{
  "keys": [
    {
      "kty": "RSA",
      "alg": "RS256",
      "n": "v6xydqciFKGfvQaqYGmk9A7etbfvNY...",
      "e": "AQAB",
      "key_ops": ["verify"],
      "ext": true,
      "kid": "9Gx7-Kkz_18DhpQ...",
      "use": "sig"
    }
  ]
}
</pre>
<a href="#section-a.8-6" class="pilcrow">¶</a>
</div>
</section>
<section id="section-a.9">
        <h2 id="name-rp-fetches-entity-statements">
<a href="#section-a.9" class="section-number selfRef">A.9. </a><a href="#name-rp-fetches-entity-statements" class="section-name selfRef">RP Fetches Entity Statements</a>
        </h2>
<p id="section-a.9-1">
   The RP starts to resolve metadata for the client identifier
          https://foodl.org/ by fetching the self-issued entity statement using
          the Federation API, as described in <a href="#fetching-es" class="xref">Section 6.1</a>.
        <a href="#section-a.9-1" class="pilcrow">¶</a></p>
<p id="section-a.9-2">
   In this case, there are two possible trust chains:
        <a href="#section-a.9-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-a.9-3.1">
       eduGAIN -&gt; Feide -&gt; NTNU -&gt; Foodle
     <a href="#section-a.9-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-a.9-3.2">
       SWAMID -&gt; Foodle
     <a href="#section-a.9-3.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</section>
<section id="section-appendix.b">
      <h2 id="name-illustrative-example-of-openid">
<a href="#section-appendix.b" class="section-number selfRef">Appendix B. </a><a href="#name-illustrative-example-of-openid" class="section-name selfRef">Illustrative Example of OpenID Connect Flow Using Explicit Client Registration</a>
      </h2>
<p id="section-appendix.b-1">
        A research project has pooled resources and bought an extremely rare
        and expensive equipment (EREE) that MUST be accessible by all project
        participants disregarding which university/research
        organization/company they belong for.
        To that end, the research project has created its own federation (EREE)
        and is expecting the participants to get their organization's OPs to
        register with the EREE federation.
        These OPs are, of course, expected to be members in one or more other
        federations.
        Therefore, we have to an EREE service and an EREE federation.
        Since the EREE equipment is located in Sweden, the EREE service is also
        member of the SWAMID federation.
      <a href="#section-appendix.b-1" class="pilcrow">¶</a></p>
<section id="section-b.1">
        <h2 id="name-initial-setup-of-the-eree-se">
<a href="#section-b.1" class="section-number selfRef">B.1. </a><a href="#name-initial-setup-of-the-eree-se" class="section-name selfRef">Initial Setup of the EREE Service</a>
        </h2>
<p id="section-b.1-1">
   The EREE service choose to use the entity identifier
   <code>https://srv.eree.example.org/</code>. And upon
          deployment, EREE is setup with an elliptic curve key pair, with the
          following public key:
        <a href="#section-b.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-2">
<pre>
{
  "keys": [
    {
      "kty": "EC",
      "use": "sig",
      "kid":
        "bmRkVmk0QUY3UUdnM3NDekI4VGptRUIxVk5lRXIyVE9rRUZpMUpNbGJ...",
      "crv": "P-256",
      "x": "ypFDCBLLT7lRP8UPo12ycnIkyFjeL1yco_Iu7VZoeDk",
      "y": "1sO4UIY1Iil0_PYobPKhuhs5ocQqVWYCujXcfo47epg"
    }
  ]
}
</pre>
<a href="#section-b.1-2" class="pilcrow">¶</a>
</div>
<p id="section-b.1-3">
          The EREE service is provided files containing <code>authority_hints</code> by its
          superiors. From the EREE federation it gets:
        <a href="#section-b.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-4">
<pre>
{"https://eree.example.org":["https://eree.example.org"]}
</pre>
<a href="#section-b.1-4" class="pilcrow">¶</a>
</div>
<p id="section-b.1-5">
          from SWAMID:
        <a href="#section-b.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-6">
<pre>
{"https://swamid.se":["https://swamid.se"]}
</pre>
<a href="#section-b.1-6" class="pilcrow">¶</a>
</div>
<p id="section-b.1-7">
          and from UNINETT:
        <a href="#section-b.1-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-8">
<pre>
{"https://uninett.no":["https://uninett.no"]}
</pre>
<a href="#section-b.1-8" class="pilcrow">¶</a>
</div>
<p id="section-b.1-9">
   and so on...
        <a href="#section-b.1-9" class="pilcrow">¶</a></p>
<p id="section-b.1-10">
          On the federations side:
        <a href="#section-b.1-10" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.1-11.1">
       SWAMID is prepared to issue an entity statement about the EREE
              service.
            <a href="#section-b.1-11.1" class="pilcrow">¶</a>
</li>
          <li id="section-b.1-11.2">
       The EREE federation is prepared to issue an entity statement
              about the EREE service.
            <a href="#section-b.1-11.2" class="pilcrow">¶</a>
</li>
          <li id="section-b.1-11.3">
       UNINETT is prepared to issue an entity statement about the EREE
              service.
            <a href="#section-b.1-11.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-b.1-12">
   And finally, from the federations the EREE service also receives the
          public part of the federations signing keys.
        <a href="#section-b.1-12" class="pilcrow">¶</a></p>
</section>
<section id="section-b.2">
        <h2 id="name-researcher-wants-to-start-a-">
<a href="#section-b.2" class="section-number selfRef">B.2. </a><a href="#name-researcher-wants-to-start-a-" class="section-name selfRef">Researcher Wants to Start a Job at the EREE Service</a>
        </h2>
<p id="section-b.2-1">
   A researcher from Umeae wants to access the EREE service.
          The EREE service provides a discovery service which allows the
          researcher to choose which OP to use. In this case,
          <code>https://op.umu.se/</code>.
        <a href="#section-b.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-b.3">
        <h2 id="name-the-eree-rp-discovers-and-in">
<a href="#section-b.3" class="section-number selfRef">B.3. </a><a href="#name-the-eree-rp-discovers-and-in" class="section-name selfRef">The EREE RP Discovers and Initiates Explicit Registration</a>
        </h2>
<section id="section-b.3.1">
          <h3 id="name-the-eree-rp-discovers-the-op">
<a href="#section-b.3.1" class="section-number selfRef">B.3.1. </a><a href="#name-the-eree-rp-discovers-the-op" class="section-name selfRef">The EREE RP Discovers the OpenID Provider</a>
          </h3>
<p id="section-b.3.1-1">
            Using the entity ID (issuer ID) of the OP the service
            performs a fetch entity statement request as described in
            <a href="#fetch_statement" class="xref">Section 5.1.1</a>.
          <a href="#section-b.3.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.3.1-2">
<pre>
 GET
 /.well-known/openid-federation?iss=https%3A%2F%2Fop.umu.se
 HTTP/1.1
 Host: op.umu.se
</pre>
<a href="#section-b.3.1-2" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.3.1-3">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

eyJhbGciOiJFUzI1NiIsImtpZCI6IlFVOUxUbkpzTjJ4VVRYQkZSM040T1Z...
</pre>
<a href="#section-b.3.1-3" class="pilcrow">¶</a>
</div>
<p id="section-b.3.1-4">
     The decoded version of the entity statement is:
          <a href="#section-b.3.1-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.3.1-5">
<pre>
{
  "authority_hints": {
    "https://eree.example.org": [
      "https://eree.example.org"
    ],
    "https://swamid.se": [
      "https://swamid.se"
    ]
  },
  "exp": 1543851936,
  "iat": 1543247136,
  "iss": "https://op.umu.se",
  "sub": "https://op.umu.se",
  "jwks": {
    "keys": [
      {
        "crv": "P-256",
        "kid":
          "QU9LTnJsN2xUTXBFR3N4OVZOeTlyejFrWWthYWlaTllYMDR...",
        "kty": "EC",
        "use": "sig",
        "x": "DU6e1SjvW3Gqcd7up-n8s1N6Zlm2cNlZjYqL3O36v1A",
        "y": "pEtk0_fSKN56V-2hDnzFUbaw8-v0QBjNoT2KaZ7pqIc"
      }
    ]
  },
  "metadata": {
    "openid_provider": {
      "federation_types_supported": ["explicit"],
      "authorization_endpoint":
        "https://op.umu.se/authorization",
      "federation_registration_endpoint":
        "https://op.umu.se/fedreg",
      "grant_types_supported": [
        "authorization_code",
        "implicit",
        "urn:ietf:params:oauth:grant-type:jwt-bearer"
      ],
      "id_token_signing_alg_values_supported": [
        "RS256"
      ],
      "logo_uri":
        "https://www.umu.se/img/umu-logo-left-neg-SE.svg",
      "policy_uri":
        "https://www.umu.se/en/website/legal-information/",
      "response_types_supported": [
        "code",
        "code id_token",
        "token"
      ],
      "subject_types_supported": [
        "pairwise",
        "public"
      ],
      "token_endpoint": "https://op.umu.se/token",
      "userinfo_endpoint": "https://op.umu.se/user"
    }
  }
}
</pre>
<a href="#section-b.3.1-5" class="pilcrow">¶</a>
</div>
</section>
<section id="section-b.3.2">
          <h3 id="name-resolving-the-ops-trust-chain-2">
<a href="#section-b.3.2" class="section-number selfRef">B.3.2. </a><a href="#name-resolving-the-ops-trust-chain-2" class="section-name selfRef">Resolving the OP's Trust Chain</a>
          </h3>
<p id="section-b.3.2-1">
            In order to establish trust with this OP, the EREE service
            provider would need to fetch sufficient entity statements to
            represent a complete chain from the self-issued statement to the
            trust anchor that represents the EREE federations.
          <a href="#section-b.3.2-1" class="pilcrow">¶</a></p>
<p id="section-b.3.2-2">
            The <code>authority_hints</code> in the self-signed entity statement points to
            2 trust anchors "https://eree.example.org" and "https://swamid.se"
            of these only the <code>EREE</code> one is interesting.
     The RP therefore chooses
            to only follow that trust path. The next step being to fetch an
            entity statement about "https://op.umu.se" signed by the EREE
            federation. This is done by doing a fetch entity statement:
          <a href="#section-b.3.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.3.2-3">
<pre>
GET
/.well-known/openid-federation?
iss=https%3A%2F%2Feree.example.org&amp;
sub=https%3A%2F%2Fop.umu.se HTTP/1.1
Host: eree.example.org
</pre>
<a href="#section-b.3.2-3" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-b.3.2-4">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

eyJhbGciOiJFUzI1NiIsImtpZCI6IlFuRlJWMEZ6YjE5NVdW...
</pre>
<a href="#section-b.3.2-4" class="pilcrow">¶</a>
</div>
<p id="section-b.3.2-5">
     The decoded version of the returned entity statement is:
          <a href="#section-b.3.2-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.3.2-6">
<pre>
{
  "exp": 1543852816,
  "iat": 1543248016,
  "iss": "https://eree.example.org/",
  "jwks": {
    "keys": [
      {
        "crv": "P-256",
        "kid":
        "QU9LTnJsN2xUTXBFR3N4OVZOeTlyejFrWWthYWlaTllYMDRXSk",
        "kty": "EC",
        "use": "sig",
        "x": "DU6e1SjvW3Gqcd7up-n8s1N6Zlm2cNlZjYqL3O36v1A",
        "y": "pEtk0_fSKN56V-2hDnzFUbaw8-v0QBjNoT2KaZ7pqIc"
      }
    ]
  },
  "metadata_policy": {
    "openid_provider": {}
  },
  "sub": "https://op.umu.se",
  "authority_hints": {
    "https://eree.example.org": [
      "https://eree.example.org"
    ]
  }
}
</pre>
<a href="#section-b.3.2-6" class="pilcrow">¶</a>
</div>
<p id="section-b.3.2-7">
            A thing worth noting about the response:
          <a href="#section-b.3.2-7" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.3.2-8.1">
                The federation does not have any restrictions on what the OP can
                be configured to do. This means that there are no metadata
                policies to apply to the metadata statement of the OP.
              <a href="#section-b.3.2-8.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-b.3.2-9">
                And the final step is to get the federations view of itself.
          <a href="#section-b.3.2-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.3.2-10">
<pre>
GET
/.well-known/openid-federation?
iss=https%3A%2F%2Feree.example.org&amp;
sub=https%3A%2F%2Feree.example.org HTTP/1.1
Host: eree.example.org
</pre>
<a href="#section-b.3.2-10" class="pilcrow">¶</a>
</div>
<p id="section-b.3.2-11">With the response<a href="#section-b.3.2-11" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.3.2-12">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

eyJhbGciOiJFUzI1NiIsImtpZCI6IlFuRlJWMEZ6YjE5NVdW...
</pre>
<a href="#section-b.3.2-12" class="pilcrow">¶</a>
</div>
<p id="section-b.3.2-13">
     The decoded version of the returned entity statement is:
          <a href="#section-b.3.2-13" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.3.2-14">
<pre>
{
  "exp": 1543852820,
  "iat": 1543248020,
  "iss": "https://eree.example.org/",
  "sub": "https://eree.example.org/",
  "jwks": {
    "keys": [
      {
        "crv": "P-256",
        "kid": "QnRSZUlvUWJ6UHdoU0V0VmFoOWs0d...",
        "kty": "EC",
        "x": "Dy8Va4JFw419muNj1gEYb3cF9xNonrY1PfpEEyqKH6A",
        "y": "lbLVj3opCTspgrySmBVvSPwgxRTCAJUfqZMcN3b0Wvk"
        "use": "sig",
      }
    ]
  },
  "metadata": {
    "federation_entity": {
        "name": "Extremely rare and expensive equipment",
        "homepage_uri": "https://www.eree.org/index.html"
    },
  }
}
</pre>
<a href="#section-b.3.2-14" class="pilcrow">¶</a>
</div>
<p id="section-b.3.2-15">
            A thing worth noting about the response:
          <a href="#section-b.3.2-15" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.3.2-16.1">
 There is no <code>authority_hints</code> entry,
 which means this entity statement describes a trust anchor.
       <a href="#section-b.3.2-16.1" class="pilcrow">¶</a>
</li>
          </ul>
</section>
<section id="section-b.3.3">
          <h3 id="name-validating-the-trust-chain-3">
<a href="#section-b.3.3" class="section-number selfRef">B.3.3. </a><a href="#name-validating-the-trust-chain-3" class="section-name selfRef">Validating the Trust Chain</a>
          </h3>
<p id="section-b.3.3-1">
     These three entity statements are sufficient to establish a path from
            the locally configured trust anchor which trust the EREE federation,
            to the self-issued statement from the OP at the
            University
            of Umeae. Here are the steps performed to validate the trust
            chain, as described in <a href="#trust_chain_validation" class="xref">Section 6.2</a>.
            We start with the signed entity statement issued by EREE about
              itself.
          <a href="#section-b.3.3-1" class="pilcrow">¶</a></p>
<ol type="1" start="1" class="normal" id="section-b.3.3-2">
            <li id="section-b.3.3-2.1">
 Verify that the <code>sub</code> in the entity statement is the EREEs entity
                ID.
              <a href="#section-b.3.3-2.1" class="pilcrow">¶</a>
</li>
            <li id="section-b.3.3-2.2">
                    Extract the <code>jwks</code> from the entity statement
                    and add possible extra keys in it to the trusted public keys for the EREE federation.
                <a href="#section-b.3.3-2.2" class="pilcrow">¶</a>
</li>
            <li id="section-b.3.3-2.3">
                  Move on to the entity statement issued by EREE about the OP.
 Verify that the <code>sub</code> in the entity statement is the OPs entity
                ID.
              <a href="#section-b.3.3-2.3" class="pilcrow">¶</a>
</li>
            <li id="section-b.3.3-2.4">
 Use the trusted public keys for the EREE federation to validate the signature of the signed entity
                statement.
              <a href="#section-b.3.3-2.4" class="pilcrow">¶</a>
</li>
            <li id="section-b.3.3-2.5">
                  Extract the <code>jwks</code> from the entity statement.
              <a href="#section-b.3.3-2.5" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-b.3.3-3">
            Now we can work on the self-signed entity statement published by
            the OP at UmU.
          <a href="#section-b.3.3-3" class="pilcrow">¶</a></p>
<ol type="1" start="1" class="normal" id="section-b.3.3-4">
            <li id="section-b.3.3-4.1">
 Verify that the <code>sub</code> and the <code>iss</code> in the entity statement is
                the OPs entity ID.
              <a href="#section-b.3.3-4.1" class="pilcrow">¶</a>
</li>
            <li id="section-b.3.3-4.2">
 Using the keys extracted above, verify the signature of the
                signed entity statement.
              <a href="#section-b.3.3-4.2" class="pilcrow">¶</a>
</li>
          </ol>
</section>
<section id="section-b.3.4">
          <h3 id="name-extracting-the-ops-metadata-2">
<a href="#section-b.3.4" class="section-number selfRef">B.3.4. </a><a href="#name-extracting-the-ops-metadata-2" class="section-name selfRef">Extracting the OP's Metadata</a>
          </h3>
<p id="section-b.3.4-1">
            The output from the trust chain validation is an ordered list of
            entity statements. In order to extract the needed metadata, we need
            to look at the metadata type relevant in the given context. In this
            case, we are establishing trust with an OP, and we use
            the <code>openid_provider</code> metadata and
     <code>metadata_policy</code> objects
            of the trust chain.
          <a href="#section-b.3.4-1" class="pilcrow">¶</a></p>
<p id="section-b.3.4-2">
       Metadata polices:
          <a href="#section-b.3.4-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.3.4-3">
<pre>
  {}
</pre>
<a href="#section-b.3.4-3" class="pilcrow">¶</a>
</div>
<p id="section-b.3.4-4">
       Metadata statement:
          <a href="#section-b.3.4-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.3.4-5">
<pre>
  {
    "authorization_endpoint":
    "https://op.umu.se/authorization",
    "federation_registration_endpoint":
      "https://op.umu.se/fedreg",
    "grant_types_supported": [
      "authorization_code",
      "implicit",
      "urn:ietf:params:oauth:grant-type:jwt-bearer"
    ],
    "id_token_signing_alg_values_supported": [
      "RS256"
    ],
    "logo_uri":
      "https://www.umu.se/img/umu-logo-left-neg-SE.svg",
    "policy_uri":
      "https://www.umu.se/en/website/legal-information/",
    "response_types_supported": [
      "code",
      "code id_token",
      "token"
    ],
    "subject_types_supported": [
      "pairwise",
      "public"
    ],
    "token_endpoint": "https://op.umu.se/token",
    "userinfo_endpoint": "https://op.umu.se/user"
  }
</pre>
<a href="#section-b.3.4-5" class="pilcrow">¶</a>
</div>
<p id="section-b.3.4-6">
            Since there is no metadata policy defined earlier in the trust chain,
     the response will just be the metadata statement as it is.
          <a href="#section-b.3.4-6" class="pilcrow">¶</a></p>
</section>
<section id="section-b.3.5">
          <h3 id="name-eree-rp-does-federated-clien">
<a href="#section-b.3.5" class="section-number selfRef">B.3.5. </a><a href="#name-eree-rp-does-federated-clien" class="section-name selfRef">EREE RP Does Federated Client Registration</a>
          </h3>
<p id="section-b.3.5-1">
            Now when the RP has trusted information about the OP it can do a
            dynamic client registration. To that end it collects information
            about
            itself that it wants to register. This should be no different from
            what a normal OpenID Connect RP using dynamic client registration does.
     To this it adds "federation_type"="explicit", the RP
            federation signing keys, the <code>sub</code> and <code>authority_hints</code>.
            Ones it has all that information it
            creates an entity statement. The result of all this work may look
            something like this:
          <a href="#section-b.3.5-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.3.5-2">
<pre>
{
  "authority_hints": {
    "https://eree.example.org": [
      "https://eree.example.org"
    ]
  },
  "jwks": {
    "keys": [
      {
        "crv": "P-256",
        "kid":
          "bmRkVmk0QUY3UUdnM3NDekI4VGptRUIxVk5lRXIyVE9rRUZpMUpNb...",
        "kty": "EC",
        "use": "sig",
        "x": "ypFDCBLLT7lRP8UPo12ycnIkyFjeL1yco_Iu7VZoeDk",
        "y": "1sO4UIY1Iil0_PYobPKhuhs5ocQqVWYCujXcfo47epg"
      }
    ]
  },
  "metadata": {
    "openid_relying_party": {
      "federation_type": "explicit",
      "application_type": "web",
      "request_object_signing_alg": "ES256",
      "response_types": [
        "code"
      ],
      "scope": [
        "openid",
        "email"
      ],
      "token_endpoint_auth_method": "private_key_jwt",
      "token_endpoint_auth_signing_alg": "ES256",
      "userinfo_signed_response_alg": "ES256"
    }
  },
  "iss": "https://rp.eree.example.org",
  "sub": "https://rp.eree.example.org"
}
</pre>
<a href="#section-b.3.5-2" class="pilcrow">¶</a>
</div>
<p id="section-b.3.5-3">
     Next, it self-signs this statement and sends it as a client
            registration request to the <code>federation_registration_endpoint</code> of
            the OP.
          <a href="#section-b.3.5-3" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-b.4">
        <h2 id="name-the-op-processes-a-client-re">
<a href="#section-b.4" class="section-number selfRef">B.4. </a><a href="#name-the-op-processes-a-client-re" class="section-name selfRef">The OP Processes a Client Registration Request</a>
        </h2>
<section id="section-b.4.1">
          <h3 id="name-the-op-gathers-the-rps-trust">
<a href="#section-b.4.1" class="section-number selfRef">B.4.1. </a><a href="#name-the-op-gathers-the-rps-trust" class="section-name selfRef">The OP Gathers the RPs Trust Chains</a>
          </h3>
<p id="section-b.4.1-1">
            To collect the trust chains the OP uses the <code>authority_hints</code> in the
            self-signed entity statement it received from the RP (the client
            registration request).
          <a href="#section-b.4.1-1" class="pilcrow">¶</a></p>
<p id="section-b.4.1-2">
            In this case, there is only one, which points to
            <code>https://eree.example.org</code>.
     Therefore, the OP fetches the entity
            statement that the EREE federation publishes on the EREE RP.
          <a href="#section-b.4.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.4.1-3">
<pre>
GET
/.well-known/openid-federation?
iss=https%3A%2F%2Feree.example.org&amp;
sub=https%3A%2F%2Frp.eree.example.org HTTP/1.1
Host: eree.example.org
</pre>
<a href="#section-b.4.1-3" class="pilcrow">¶</a>
</div>
<p id="section-b.4.1-4">
            With the response:
          <a href="#section-b.4.1-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.4.1-5">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

eyJhbGciOiJFUzI1NiIsImtpZCI6IlFuRlJWMEZ6YjE5NVd...
</pre>
<a href="#section-b.4.1-5" class="pilcrow">¶</a>
</div>
<p id="section-b.4.1-6">
            Unpacked this becomes:
          <a href="#section-b.4.1-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.4.1-7">
<pre>
{
  "exp": 1543865440,
  "iat": 1543260640,
  "iss": "https://eree.example.org",
  "jwks": {
    "keys": [
      {
        "crv": "P-256",
        "kid":
          "bmRkVmk0QUY3UUdnM3NDekI4VGptRUIxVk5lRXIyVE9rRUZpM...",
        "kty": "EC",
        "use": "sig",
        "x": "ypFDCBLLT7lRP8UPo12ycnIkyFjeL1yco_Iu7VZoeDk",
        "y": "1sO4UIY1Iil0_PYobPKhuhs5ocQqVWYCujXcfo47epg"
      }
    ]
  },
  "metadata_policy": {
    "openid_relying_party": {
      "federation_type": "explicit",
      "application_type": {"value": "web"},
      "request_object_signing_alg": {"value":"ES256"},
      "response_types": {"subset_of":["code"]},
      "scope": {"subset_of":["openid","email"]},
      "token_endpoint_auth_method":
        {"value": "private_key_jwt"},
      "token_endpoint_auth_signing_alg":
        {"value":"ES256"},
      "userinfo_signed_response_alg":
        {"value": "ES256"}
    }
  },
  "sub": "https://rp.eree.example.org"
}
</pre>
<a href="#section-b.4.1-7" class="pilcrow">¶</a>
</div>
</section>
<section id="section-b.4.2">
          <h3 id="name-validating-the-trust-chain-4">
<a href="#section-b.4.2" class="section-number selfRef">B.4.2. </a><a href="#name-validating-the-trust-chain-4" class="section-name selfRef">Validating the Trust Chain</a>
          </h3>
<p id="section-b.4.2-1">
            The process here is the one described in
            <a href="#trust_chain_validation" class="xref">Section 6.2</a>.
          <a href="#section-b.4.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-b.4.3">
          <h3 id="name-extracting-rp-metadata-2">
<a href="#section-b.4.3" class="section-number selfRef">B.4.3. </a><a href="#name-extracting-rp-metadata-2" class="section-name selfRef">Extracting RP Metadata</a>
          </h3>
<p id="section-b.4.3-1">
            The OP applies the metadata policies on the leaf entity's
            metadata, all from the trust chain and comes up with:
          <a href="#section-b.4.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.4.3-2">
<pre>
{
  "application_type": "web",
  "application_name": "EREE",
  "contacts": ["ops@eree.example.org"],
  "jwks_uri": "https://rp.eree.example.org/static/jwks.json",
  "redirect_uris": [
    "https://rp.eree.example.org/authz_cb"
  ],
  "request_object_signing_alg": "ES256",
  "response_types": [
    "code"
  ],
  "scope": [
    "openid",
    "email"
  ],
  "token_endpoint_auth_method": "private_key_jwt",
  "token_endpoint_auth_signing_alg": "ES256",
  "userinfo_signed_response_alg": "ES256"
}
</pre>
<a href="#section-b.4.3-2" class="pilcrow">¶</a>
</div>
</section>
<section id="section-b.4.4">
          <h3 id="name-constructing-the-registratio">
<a href="#section-b.4.4" class="section-number selfRef">B.4.4. </a><a href="#name-constructing-the-registratio" class="section-name selfRef">Constructing the Registration Response</a>
          </h3>
<p id="section-b.4.4-1">
            Happy with the information in the client registration request the
            OP constructs its metadata policy and creates an entity statement by
            adding <code>sub</code> and <code>authority_hints</code>:
          <a href="#section-b.4.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.4.4-2">
<pre>
{
  "authority_hints": {
    "https://eree.example.org": [
      "https://eree.example.org"
    ]
  },
  "exp": 1543931097,
  "iat": 1543326297,
  "iss": "https://op.umu.se",
  "metadata_policy": {
    "openid_relying_party": {
      "client_id": {"value": "FjeL1yco_Iu7VZoeDk"}
    }
  },
  "sub": "https://rp.eree.example.org"
}
</pre>
<a href="#section-b.4.4-2" class="pilcrow">¶</a>
</div>
</section>
</section>
<section id="section-b.5">
        <h2 id="name-the-rp-processes-the-registr">
<a href="#section-b.5" class="section-number selfRef">B.5. </a><a href="#name-the-rp-processes-the-registr" class="section-name selfRef">The RP Processes the Registration Response</a>
        </h2>
<p id="section-b.5-1">
          The RP MUST collect the trust chain ending in the EREE trust anchor
          using the process described in <a href="#resolving_trust" class="xref">Section 6</a>,
          but refrain from processing
          the metadata. This since the entity statement issued by the EREE
          federation about the UmU OP are only valid for that entity and not
          for the EREE RP. The trust chain should only be used to verify that
          the entity statement actually comes from the expected OP.
        <a href="#section-b.5-1" class="pilcrow">¶</a></p>
<p id="section-b.5-2">
          If the RP is OK with what the OP decided on regarding the RP's
          metadata, then it will store this to be used in the following OpenID Connect
          protocol exchange with the OP.
        <a href="#section-b.5-2" class="pilcrow">¶</a></p>
<p id="section-b.5-3">
          In this example, the RP decided on one specific trust anchor before
          sending the registration request. If that was not the case but the
          RP had chosen to send a registration request with more than one
          authority hint, then this by time the RP could not apply any
          metadata polices to the metadata statement, since it would not know
          which to use.
        <a href="#section-b.5-3" class="pilcrow">¶</a></p>
</section>
</section>
<div id="Notices">
<section id="section-appendix.c">
      <h2 id="name-notices-2">
<a href="#section-appendix.c" class="section-number selfRef">Appendix C. </a><a href="#name-notices-2" class="section-name selfRef">Notices</a>
      </h2>
<p id="section-appendix.c-1">
 Copyright (c) 2019 The OpenID Foundation.
      <a href="#section-appendix.c-1" class="pilcrow">¶</a></p>
<p id="section-appendix.c-2">
 The OpenID Foundation (OIDF) grants to any Contributor, developer,
        implementer, or other interested party a non-exclusive, royalty free,
        worldwide copyright license to reproduce, prepare derivative works from,
        distribute, perform and display, this Implementers Draft or Final
        Specification solely for the purposes of (i) developing specifications,
        and (ii) implementing Implementers Drafts and Final Specifications based
        on such documents, provided that attribution be made to the OIDF as the
        source of the material, but that such attribution does not indicate an
        endorsement by the OIDF.
      <a href="#section-appendix.c-2" class="pilcrow">¶</a></p>
<p id="section-appendix.c-3">
 The technology described in this specification was made available
        from contributions from various sources, including members of the OpenID
        Foundation and others. Although the OpenID Foundation has taken steps to
        help ensure that the technology is available for distribution, it takes
        no position regarding the validity or scope of any intellectual property
        or other rights that might be claimed to pertain to the implementation
        or use of the technology described in this specification or the extent
        to which any license under such rights might or might not be available;
        neither does it represent that it has made any independent effort to
        identify any such rights. The OpenID Foundation and the contributors to
        this specification make no (and hereby expressly disclaim any)
        warranties (express, implied, or otherwise), including implied
        warranties of merchantability, non-infringement, fitness for a
        particular purpose, or title, related to this specification, and the
        entire risk as to implementing this specification is assumed by the
        implementer. The OpenID Intellectual Property Rights policy requires
        contributors to offer a patent promise not to assert certain patent
        claims against other contributors and against implementers. The OpenID
        Foundation invites any interested party to bring to its attention any
        copyrights, patents, patent applications, or other proprietary rights
        that may cover technology that may be required to practice this
        specification.
      <a href="#section-appendix.c-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Acknowledgements">
<section id="section-appendix.d">
      <h2 id="name-acknowledgements-2">
<a href="#section-appendix.d" class="section-number selfRef">Appendix D. </a><a href="#name-acknowledgements-2" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-appendix.d-1">
 The authors wish to acknowledge the contributions of the following individuals and organizations to this specification:
 Heather Flanagan,
 Misha Salle,
 Peter Schober,
 Michael Schwartz,
 and
 the JRA3T3 task force of GEANT4-2.
      <a href="#section-appendix.d-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="TBD">
<section id="section-appendix.e">
      <h2 id="name-open-issues-2">
<a href="#section-appendix.e" class="section-number selfRef">Appendix E. </a><a href="#name-open-issues-2" class="section-name selfRef">Open Issues</a>
      </h2>
<p id="section-appendix.e-1">
 The following open issues remain to be addressed in this specification.
      <a href="#section-appendix.e-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.e-2.1">
     The representation for RPs that are native applications needs to be defined.
   <a href="#section-appendix.e-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.e-2.2">
     How are federation operator keys retrieved?
   <a href="#section-appendix.e-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.e-2.3">
     A mechanism is needed for key rotation of federation operator keys
     for long-term security and maintainability of federations.
   <a href="#section-appendix.e-2.3" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.e-2.4">
     A mechanism may be needed for bounding key lifetimes.
   <a href="#section-appendix.e-2.4" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.e-2.5">
     Discuss that key IDs may be chosen as the JWK Thumbprint [RFC 7638] of the key.
   <a href="#section-appendix.e-2.5" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.e-2.6">
     Discuss localization of human-readable strings.
   <a href="#section-appendix.e-2.6" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.e-2.7">
     SAML2 as used in Research and Education federations uses post-/prefix
     matching on metadata in some cases. We might need something
     similar or just use regular expressions.
   <a href="#section-appendix.e-2.7" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.e-2.8">
     Define the relationship between trust roots and Federation Operators,
     as people will expect to find the Federation Operator term in the specification.
   <a href="#section-appendix.e-2.8" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.e-2.9">
     Add a diagram showing the relationships between FOs, orgs, sub-orgs, and leaf entities.
   <a href="#section-appendix.e-2.9" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="History">
<section id="section-appendix.f">
      <h2 id="name-document-history-2">
<a href="#section-appendix.f" class="section-number selfRef">Appendix F. </a><a href="#name-document-history-2" class="section-name selfRef">Document History</a>
      </h2>
<p id="section-appendix.f-1">[[ To be removed from the final specification ]]<a href="#section-appendix.f-1" class="pilcrow">¶</a></p>
<p id="section-appendix.f-2">
 -08
      <a href="#section-appendix.f-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.f-3.1">
     Incorporated review feedback from Michael B. Jones.
     Major changes were as follows.
   <a href="#section-appendix.f-3.1" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.2">
     Deleted <code>sub_is_leaf</code> entity statement since it was redundant.
   <a href="#section-appendix.f-3.2" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.3">
     Added <code>federation_type</code> RP registration metadata value
     and <code>federation_types_supported</code> OP metadata value.
   <a href="#section-appendix.f-3.3" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.4">
     Deleted <code>openid_discovery</code> metadata type identifier
     since its purpose is already served by <code>openid_provider</code>.
   <a href="#section-appendix.f-3.4" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.5">
     Entity identifier paths are now included when using the Federation API,
     enabling use in multi-tenant deployments sharing a common domain name.
   <a href="#section-appendix.f-3.5" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.6">
     Renamed <code>sub_is_leaf</code> to <code>is_leaf</code>
     in the Entity Listings Request operation parameters.
   <a href="#section-appendix.f-3.6" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.7">
     Added <code>crit</code> and <code>policy_language_crit</code>,
     enabling control over which entity statement and policy language extensions
     MUST be understood and processed.
   <a href="#section-appendix.f-3.7" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.8">
     Renamed <code>openid_client</code> to <code>openid_relying_party</code>.
   <a href="#section-appendix.f-3.8" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.9">
     Renamed <code>oauth_service</code> to <code>oauth_authorization_server</code>.
   <a href="#section-appendix.f-3.9" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.10">
     Renamed <code>implicit</code> registration to <code>automatic</code> registration
     to avoid naming confusion with the implicit grant type.
   <a href="#section-appendix.f-3.10" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.11">
     Renamed <code>op</code> to <code>operation</code>
     to avoid naming confusion with the use of "OP" as an acronym for "OpenID Provider".
   <a href="#section-appendix.f-3.11" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.12">
     Renamed <code>url</code> to <code>uri</code> in several identifiers.
   <a href="#section-appendix.f-3.12" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.13">
     Restored Open Issues appendix.
   <a href="#section-appendix.f-3.13" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-3.14">
     Corrected document formatting issues.
   <a href="#section-appendix.f-3.14" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.f-4">
 -07
      <a href="#section-appendix.f-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.f-5.1">
     Split metadata into metadata and metadata_policy
   <a href="#section-appendix.f-5.1" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-5.2">
     Updated example
   <a href="#section-appendix.f-5.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.f-6">
 -06
      <a href="#section-appendix.f-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.f-7.1">
     Some rewrites
   <a href="#section-appendix.f-7.1" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-7.2">
     Added example of explicit client registration
   <a href="#section-appendix.f-7.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.f-8">
 -05
      <a href="#section-appendix.f-8" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.f-9.1">
     A major rewrite.
   <a href="#section-appendix.f-9.1" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.f-10">
 -04
      <a href="#section-appendix.f-10" class="pilcrow">¶</a></p>
<ul>
<li id="section-appendix.f-11.1">
     Changed client metadata names
            <code>scopes</code>
            to <code>rp_scopes</code> and
            <code>claims</code>
            to <code>rp_claims</code>.
          <a href="#section-appendix.f-11.1" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-11.2">
     Added Open Issues appendix.
   <a href="#section-appendix.f-11.2" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-11.3">
     Added additional references.
   <a href="#section-appendix.f-11.3" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-11.4">
     Editorial improvements.
   <a href="#section-appendix.f-11.4" class="pilcrow">¶</a>
</li>
        <li id="section-appendix.f-11.5">
     Added standard Notices section, which is present in all OpenID
            specifications.
          <a href="#section-appendix.f-11.5" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.g">
      <h2 id="name-authors-addresses-2">
<a href="#name-authors-addresses-2" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Roland Hedberg (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">independent</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:roland@catalogix.se" class="email">roland@catalogix.se</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael B. Jones</span></div>
<div dir="auto" class="left"><span class="org">Microsoft</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mbj@microsoft.com" class="email">mbj@microsoft.com</a>
</div>
<div class="url">
<span>URI:</span>
<a href="http://self-issued.info/" class="url">http://self-issued.info/</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Andreas Åkre Solberg</span></div>
<div dir="auto" class="left"><span class="org">Uninett AS</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:andreas.solberg@uninett.no" class="email">andreas.solberg@uninett.no</a>
</div>
<div class="url">
<span>URI:</span>
<a href="https://www.linkedin.com/in/andreassolberg/" class="url">https://www.linkedin.com/in/andreassolberg/</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Samuel Gulliksson</span></div>
<div dir="auto" class="left"><span class="org">Schibsted Media Group</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:samuel.gulliksson@gmail.com" class="email">samuel.gulliksson@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Bradley</span></div>
<div dir="auto" class="left"><span class="org">Yubico</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ve7jtb@ve7jtb.com" class="email">ve7jtb@ve7jtb.com</a>
</div>
<div class="url">
<span>URI:</span>
<a href="http://www.thread-safe.com/" class="url">http://www.thread-safe.com/</a>
</div>
</address>
</section>
</div>
<script>var toc = document.getElementById("toc");
var tocToggle = toc.querySelector("h2");
var tocNav = toc.querySelector("nav");

// mobile menu toggle
tocToggle.onclick = function(event) {
    if (window.innerWidth < 1024) {
 var tocNavDisplay = tocNav.currentStyle ? tocNav.currentStyle.display : getComputedStyle(tocNav, null).display;
 if (tocNavDisplay == "none") {
     tocNav.style.display = "block";
 } else {
     tocNav.style.display = "none";
 }
    }
}

// toc anchor scroll to anchor
tocNav.addEventListener("click", function (event) {
    event.preventDefault();
    if (event.target.nodeName == 'A') {
 if (window.innerWidth < 1024) {
     tocNav.style.display = "none";
 }
 var href = event.target.getAttribute("href");
 var anchorId = href.substr(1);
 var anchor =  document.getElementById(anchorId);
 anchor.scrollIntoView(true);
 window.history.pushState("","",href);
    }
});

// switch toc mode when window resized
window.onresize = function () {
    if (window.innerWidth < 1024) {
 tocNav.style.display = "none";
    } else {
 tocNav.style.display = "block";
    }
}
</script>
</body>
</html>
